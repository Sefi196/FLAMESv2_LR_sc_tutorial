<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 12 Differential Transcript Usage (DTU) | Long-read Single-Cell RNA-seq analysis tutorial</title>
  <meta name="description" content="Chapter 12 Differential Transcript Usage (DTU) | Long-read Single-Cell RNA-seq analysis tutorial" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 12 Differential Transcript Usage (DTU) | Long-read Single-Cell RNA-seq analysis tutorial" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 12 Differential Transcript Usage (DTU) | Long-read Single-Cell RNA-seq analysis tutorial" />
  
  
  

<meta name="author" content="Sefi Prawer Postdoctoral Research Fellow in Long Reads and Single-Cell Transcriptomics University of Melbourne" />


<meta name="date" content="2025-11-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="conclusion.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Long-read Single-Cell RNA-seq analysis tutorial</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> <strong>Introduction</strong></a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i><b>1.1</b> Prerequisites</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#getting-started-with-the-data"><i class="fa fa-check"></i><b>1.2</b> Getting Started with the Data</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#dataset-information"><i class="fa fa-check"></i><b>1.3</b> Dataset Information</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i><b>1.4</b> Citation</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#contact"><i class="fa fa-check"></i><b>1.5</b> Contact</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>2</b> <strong>Setup</strong></a>
<ul>
<li class="chapter" data-level="2.1" data-path="setup.html"><a href="setup.html#load-in-required-packages"><i class="fa fa-check"></i><b>2.1</b> Load in required packages</a></li>
<li class="chapter" data-level="2.2" data-path="setup.html"><a href="setup.html#creating-resource-files."><i class="fa fa-check"></i><b>2.2</b> Creating resource files.</a></li>
<li class="chapter" data-level="2.3" data-path="setup.html"><a href="setup.html#convert-count-matrices-from-gene-id-to-gene-symbol"><i class="fa fa-check"></i><b>2.3</b> Convert count matrices from Gene ID to gene Symbol</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html"><a href="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html"><i class="fa fa-check"></i><b>3</b> <strong>Removing sources of unwanted noise from the single cell dataset</strong></a>
<ul>
<li class="chapter" data-level="3.1" data-path="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html"><a href="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html#empty-droplets"><i class="fa fa-check"></i><b>3.1</b> Empty droplets</a></li>
<li class="chapter" data-level="3.2" data-path="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html"><a href="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html#removing-ambient-rna-contamination"><i class="fa fa-check"></i><b>3.2</b> Removing ambient RNA contamination</a></li>
<li class="chapter" data-level="3.3" data-path="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html"><a href="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html#standard-gene-qc-to-remove-low-quality-cells"><i class="fa fa-check"></i><b>3.3</b> Standard gene QC to remove low quality cells</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="add-isoform-counts-to-seurat-object.html"><a href="add-isoform-counts-to-seurat-object.html"><i class="fa fa-check"></i><b>4</b> <strong>Add isoform counts to Seurat object</strong></a>
<ul>
<li class="chapter" data-level="4.1" data-path="add-isoform-counts-to-seurat-object.html"><a href="add-isoform-counts-to-seurat-object.html#create-a-seurat-object-with-isoform-expression-data"><i class="fa fa-check"></i><b>4.1</b> Create a Seurat object with isoform expression data</a></li>
<li class="chapter" data-level="4.2" data-path="add-isoform-counts-to-seurat-object.html"><a href="add-isoform-counts-to-seurat-object.html#filter-the-new-seurat-object-based-on-gene-level-information"><i class="fa fa-check"></i><b>4.2</b> Filter the new Seurat object based on gene level information</a></li>
<li class="chapter" data-level="4.3" data-path="add-isoform-counts-to-seurat-object.html"><a href="add-isoform-counts-to-seurat-object.html#add-the-isoform-assay-to-the-seurat-object"><i class="fa fa-check"></i><b>4.3</b> Add the isoform assay to the Seurat object</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="finding-marker-genes-and-isoforms.html"><a href="finding-marker-genes-and-isoforms.html"><i class="fa fa-check"></i><b>5</b> <strong>Finding marker genes and isoforms</strong></a>
<ul>
<li class="chapter" data-level="5.1" data-path="finding-marker-genes-and-isoforms.html"><a href="finding-marker-genes-and-isoforms.html#differentially-expressed-genes-by-cluster-identity"><i class="fa fa-check"></i><b>5.1</b> Differentially expressed genes by cluster identity</a></li>
<li class="chapter" data-level="5.2" data-path="finding-marker-genes-and-isoforms.html"><a href="finding-marker-genes-and-isoforms.html#identifying-cell-types"><i class="fa fa-check"></i><b>5.2</b> Identifying cell types</a></li>
<li class="chapter" data-level="5.3" data-path="finding-marker-genes-and-isoforms.html"><a href="finding-marker-genes-and-isoforms.html#de-genes-and-isoforms-based-on-annotated-cell-types."><i class="fa fa-check"></i><b>5.3</b> DE genes and isoforms based on annotated cell types.</a></li>
<li class="chapter" data-level="5.4" data-path="finding-marker-genes-and-isoforms.html"><a href="finding-marker-genes-and-isoforms.html#volcano-plots"><i class="fa fa-check"></i><b>5.4</b> Volcano plots</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="finding-marker-genes-and-isoforms.html"><a href="finding-marker-genes-and-isoforms.html#findallmarkers-de"><i class="fa fa-check"></i><b>5.4.1</b> FindAllMarkers DE</a></li>
<li class="chapter" data-level="5.4.2" data-path="finding-marker-genes-and-isoforms.html"><a href="finding-marker-genes-and-isoforms.html#findmarkers-de"><i class="fa fa-check"></i><b>5.4.2</b> FindMarkers DE</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exploring-isoforms-of-interest.html"><a href="exploring-isoforms-of-interest.html"><i class="fa fa-check"></i><b>6</b> <strong>Exploring isoforms of interest</strong></a>
<ul>
<li class="chapter" data-level="6.1" data-path="exploring-isoforms-of-interest.html"><a href="exploring-isoforms-of-interest.html#isoforms-expressed-per-gene"><i class="fa fa-check"></i><b>6.1</b> Isoforms expressed per gene</a></li>
<li class="chapter" data-level="6.2" data-path="exploring-isoforms-of-interest.html"><a href="exploring-isoforms-of-interest.html#top-10-genes-with-most-isoforms"><i class="fa fa-check"></i><b>6.2</b> Top 10 Genes with Most Isoforms</a></li>
<li class="chapter" data-level="6.3" data-path="exploring-isoforms-of-interest.html"><a href="exploring-isoforms-of-interest.html#exploring-macf1-isoforms"><i class="fa fa-check"></i><b>6.3</b> Exploring <em>MACF1</em> isoforms</a></li>
<li class="chapter" data-level="6.4" data-path="exploring-isoforms-of-interest.html"><a href="exploring-isoforms-of-interest.html#expression-of-macf1-isoforms-across-cell-types"><i class="fa fa-check"></i><b>6.4</b> Expression of <em>MACF1</em> isoforms Across Cell Types</a></li>
<li class="chapter" data-level="6.5" data-path="exploring-isoforms-of-interest.html"><a href="exploring-isoforms-of-interest.html#visualization-of-isoform-structures"><i class="fa fa-check"></i><b>6.5</b> Visualization of Isoform Structures</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="isoform-classification.html"><a href="isoform-classification.html"><i class="fa fa-check"></i><b>7</b> <strong>Isoform Classification</strong></a>
<ul>
<li class="chapter" data-level="7.1" data-path="isoform-classification.html"><a href="isoform-classification.html#classification-with-sqanti"><i class="fa fa-check"></i><b>7.1</b> Classification with SQANTI</a></li>
<li class="chapter" data-level="7.2" data-path="isoform-classification.html"><a href="isoform-classification.html#cell-type-specific-isoforms"><i class="fa fa-check"></i><b>7.2</b> Cell type specific isoforms</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="novel-isoforms.html"><a href="novel-isoforms.html"><i class="fa fa-check"></i><b>8</b> <strong>Novel isoforms</strong></a>
<ul>
<li class="chapter" data-level="8.1" data-path="novel-isoforms.html"><a href="novel-isoforms.html#find-all-the-genes-that-express-at-least-1-novel-isoform"><i class="fa fa-check"></i><b>8.1</b> Find all the genes that express at least 1 novel isoform</a></li>
<li class="chapter" data-level="8.2" data-path="novel-isoforms.html"><a href="novel-isoforms.html#visualising-oaz2-novel-isoform"><i class="fa fa-check"></i><b>8.2</b> Visualising OAZ2 novel isoform</a></li>
<li class="chapter" data-level="8.3" data-path="novel-isoforms.html"><a href="novel-isoforms.html#functional-impacts-of-novel-isoforms"><i class="fa fa-check"></i><b>8.3</b> Functional impacts of novel isoforms</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="profiling-isoform-diversity.html"><a href="profiling-isoform-diversity.html"><i class="fa fa-check"></i><b>9</b> <strong>Profiling Isoform Diversity</strong></a>
<ul>
<li class="chapter" data-level="9.1" data-path="profiling-isoform-diversity.html"><a href="profiling-isoform-diversity.html#measuring-entropy-with-find_diversity-function"><i class="fa fa-check"></i><b>9.1</b> Measuring entropy with <code>find_diversity()</code> function</a></li>
<li class="chapter" data-level="9.2" data-path="profiling-isoform-diversity.html"><a href="profiling-isoform-diversity.html#example-of-a-low-entropy-gene"><i class="fa fa-check"></i><b>9.2</b> Example of a low entropy gene</a></li>
<li class="chapter" data-level="9.3" data-path="profiling-isoform-diversity.html"><a href="profiling-isoform-diversity.html#example-of-a-high-entropy-gene"><i class="fa fa-check"></i><b>9.3</b> Example of a high entropy gene</a></li>
<li class="chapter" data-level="9.4" data-path="profiling-isoform-diversity.html"><a href="profiling-isoform-diversity.html#broadening-entropy-analysis"><i class="fa fa-check"></i><b>9.4</b> Broadening Entropy Analysis</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="multisample-analysis.html"><a href="multisample-analysis.html"><i class="fa fa-check"></i><b>10</b> <strong>Multisample analysis</strong></a>
<ul>
<li class="chapter" data-level="10.0.1" data-path="multisample-analysis.html"><a href="multisample-analysis.html#dataset-information-1"><i class="fa fa-check"></i><b>10.0.1</b> Dataset Information</a></li>
<li class="chapter" data-level="10.1" data-path="multisample-analysis.html"><a href="multisample-analysis.html#standard-pre-processing-and-quality-control"><i class="fa fa-check"></i><b>10.1</b> Standard pre-processing and quality control</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="multisample-analysis.html"><a href="multisample-analysis.html#define-qc-function"><i class="fa fa-check"></i><b>10.1.1</b> Define QC function</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="multisample-analysis.html"><a href="multisample-analysis.html#multisample-integration"><i class="fa fa-check"></i><b>10.2</b> Multisample integration</a></li>
<li class="chapter" data-level="10.3" data-path="multisample-analysis.html"><a href="multisample-analysis.html#add-isoform-counts"><i class="fa fa-check"></i><b>10.3</b> Add isoform counts</a></li>
<li class="chapter" data-level="10.4" data-path="multisample-analysis.html"><a href="multisample-analysis.html#identify-cell-types"><i class="fa fa-check"></i><b>10.4</b> Identify cell types</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html"><i class="fa fa-check"></i><b>11</b> <strong>Trajectory analysis</strong></a>
<ul>
<li class="chapter" data-level="11.1" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#running-pseudotime-analysis-on-genes"><i class="fa fa-check"></i><b>11.1</b> Running pseudotime analysis on genes</a></li>
<li class="chapter" data-level="11.2" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#running-pseudotime-analysis-on-isoforms"><i class="fa fa-check"></i><b>11.2</b> Running pseudotime analysis on isoforms</a></li>
<li class="chapter" data-level="11.3" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#summary-and-downstream-applications"><i class="fa fa-check"></i><b>11.3</b> Summary and downstream applications</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><strong>Conclusion</strong></a>
<ul>
<li class="chapter" data-level="" data-path="conclusion.html"><a href="conclusion.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="conclusion.html"><a href="conclusion.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="differential-transcript-usage-dtu.html"><a href="differential-transcript-usage-dtu.html"><i class="fa fa-check"></i><b>12</b> Differential Transcript Usage (DTU)</a>
<ul>
<li class="chapter" data-level="12.1" data-path="differential-transcript-usage-dtu.html"><a href="differential-transcript-usage-dtu.html#preparing-the-data-for-dtu-analysis"><i class="fa fa-check"></i><b>12.1</b> Preparing the data for DTU analysis</a></li>
<li class="chapter" data-level="12.2" data-path="differential-transcript-usage-dtu.html"><a href="differential-transcript-usage-dtu.html#generating-a-switchlist"><i class="fa fa-check"></i><b>12.2</b> Generating a SwitchList</a></li>
<li class="chapter" data-level="12.3" data-path="differential-transcript-usage-dtu.html"><a href="differential-transcript-usage-dtu.html#visualising-dtu-hits"><i class="fa fa-check"></i><b>12.3</b> Visualising DTU Hits</a></li>
<li class="chapter" data-level="12.4" data-path="differential-transcript-usage-dtu.html"><a href="differential-transcript-usage-dtu.html#final-thoughts"><i class="fa fa-check"></i><b>12.4</b> Final thoughts</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><strong>References</strong></a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><strong>Appendix</strong></a>
<ul>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#calculating-the-ambient-rna-profile"><i class="fa fa-check"></i>Calculating the ambient RNA profile</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#multisample-qc-function"><i class="fa fa-check"></i>Multisample QC function</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#convert-oarfish-files-to-a-count-matrix"><i class="fa fa-check"></i>Convert Oarfish files to a count matrix</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Long-read Single-Cell RNA-seq analysis tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="differential-transcript-usage-dtu" class="section level1 hasAnchor" number="12">
<h1><span class="header-section-number">Chapter 12</span> Differential Transcript Usage (DTU)<a href="differential-transcript-usage-dtu.html#differential-transcript-usage-dtu" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Differential transcript usage (DTU), or isoform switching, refers to changes in the <strong>relative expression</strong> of different transcript isoforms from the same gene across conditions, cell types, or time points. Unlike traditional gene- or isoform-level differential expression, which focuses on changes in total expression, DTU specifically examines how the <em>proportions</em> of isoforms shift between groups. This provides insight into how alternative splicing and isoform regulation contribute to cellular processes and phenotypic differences.</p>
<p>DTU analysis is particularly useful for dissecting complex regulatory mechanisms, such as those underlying neuronal differentiation, disease progression, or cell state transitions, where changes in isoform usage may occur even when total gene expression remains stable. By identifying isoforms that are preferentially expressed under specific conditions, we can begin to link splicing programs to functional outcomes.</p>
<p>This area is still relatively new in the context of single-cell sequencing, and tools developed specifically for single-cell DTU are not yet well established. In this chapter, we therefore use a bulk-oriented tool, <strong>IsoformSwitchAnalyzeR</strong>, and adapt it to our long-read single-cell setting. The full vignette for IsoformSwitchAnalyzeR can be found here: <a href="https://www.bioconductor.org/packages/release/bioc/vignettes/IsoformSwitchAnalyzeR/inst/doc/IsoformSwitchAnalyzeR.html" class="uri">https://www.bioconductor.org/packages/release/bioc/vignettes/IsoformSwitchAnalyzeR/inst/doc/IsoformSwitchAnalyzeR.html</a></p>
<p>We will start by loading the required packages.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="differential-transcript-usage-dtu.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DRIMSeq)</span>
<span id="cb218-2"><a href="differential-transcript-usage-dtu.html#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DEXSeq)</span>
<span id="cb218-3"><a href="differential-transcript-usage-dtu.html#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stageR)</span>
<span id="cb218-4"><a href="differential-transcript-usage-dtu.html#cb218-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(IsoformSwitchAnalyzeR)</span>
<span id="cb218-5"><a href="differential-transcript-usage-dtu.html#cb218-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rtracklayer)</span></code></pre></div>
</details>
<div id="preparing-the-data-for-dtu-analysis" class="section level2 hasAnchor" number="12.1">
<h2><span class="header-section-number">12.1</span> Preparing the data for DTU analysis<a href="differential-transcript-usage-dtu.html#preparing-the-data-for-dtu-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Next, we will build a <strong>pseudobulk</strong> data set containing isoform expression aggregated across our sample replicates. We will use Seurat’s native <code>AggregateExpression()</code> function and group counts by both <strong>cell type</strong> and <strong>sample replicate</strong>. This effectively creates one pseudobulk profile per <em>cell type × sample</em> combination, which is more appropriate for DTU methods like IsoformSwitchAnalyzeR which cannot use individual cells.</p>
<p>In an ideal experimental design, you would have more biological replicates per time point (for example, at least three). In this tutorial we only have two replicates per time point, which is sufficient to illustrate the workflow, but additional replicates would provide more power and robustness for this type of analysis.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="differential-transcript-usage-dtu.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get pseudobulk counts split by sample and celll type</span></span>
<span id="cb219-2"><a href="differential-transcript-usage-dtu.html#cb219-2" aria-hidden="true" tabindex="-1"></a>pseudo.seurat.isoforms <span class="ot">&lt;-</span> <span class="fu">AggregateExpression</span>(</span>
<span id="cb219-3"><a href="differential-transcript-usage-dtu.html#cb219-3" aria-hidden="true" tabindex="-1"></a>  obj, </span>
<span id="cb219-4"><a href="differential-transcript-usage-dtu.html#cb219-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">assays =</span> <span class="st">&quot;iso&quot;</span>, </span>
<span id="cb219-5"><a href="differential-transcript-usage-dtu.html#cb219-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">return.seurat =</span> <span class="cn">FALSE</span>,</span>
<span id="cb219-6"><a href="differential-transcript-usage-dtu.html#cb219-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">group.by =</span> <span class="fu">c</span>(<span class="st">&quot;orig.ident&quot;</span>, <span class="st">&quot;cell_type&quot;</span>)</span>
<span id="cb219-7"><a href="differential-transcript-usage-dtu.html#cb219-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb219-8"><a href="differential-transcript-usage-dtu.html#cb219-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-9"><a href="differential-transcript-usage-dtu.html#cb219-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-10"><a href="differential-transcript-usage-dtu.html#cb219-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a dataframe from above data</span></span>
<span id="cb219-11"><a href="differential-transcript-usage-dtu.html#cb219-11" aria-hidden="true" tabindex="-1"></a>pseudo.seurat.isoforms.df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pseudo.seurat.isoforms)</span>
<span id="cb219-12"><a href="differential-transcript-usage-dtu.html#cb219-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pseudo.seurat.isoforms.df)</span></code></pre></div>
</details>
<pre><code>## [1] &quot;iso.C1.STC_Stem.cells&quot;           &quot;iso.C2.Day25_Radial.glia&quot;        &quot;iso.C2.Day25_Inhibitory.neurons&quot;
## [4] &quot;iso.C2.Day25_Excitatory.neurons&quot; &quot;iso.C4.STC_Stem.cells&quot;           &quot;iso.C5.Day25_Radial.glia&quot;       
## [7] &quot;iso.C5.Day25_Inhibitory.neurons&quot; &quot;iso.C5.Day25_Excitatory.neurons&quot;</code></pre>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="differential-transcript-usage-dtu.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define sample condtions</span></span>
<span id="cb221-2"><a href="differential-transcript-usage-dtu.html#cb221-2" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">colnames</span>(pseudo.seurat.isoforms.df))</span>
<span id="cb221-3"><a href="differential-transcript-usage-dtu.html#cb221-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-4"><a href="differential-transcript-usage-dtu.html#cb221-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the column for clarity</span></span>
<span id="cb221-5"><a href="differential-transcript-usage-dtu.html#cb221-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sample_data) <span class="ot">&lt;-</span> <span class="st">&quot;colnames&quot;</span></span>
<span id="cb221-6"><a href="differential-transcript-usage-dtu.html#cb221-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-7"><a href="differential-transcript-usage-dtu.html#cb221-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the column names into sampleID and celltype</span></span>
<span id="cb221-8"><a href="differential-transcript-usage-dtu.html#cb221-8" aria-hidden="true" tabindex="-1"></a>split_sample_data <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(sample_data<span class="sc">$</span>colnames, <span class="st">&quot;_&quot;</span>)</span></code></pre></div>
</details>
<p>Now that we have our pseudobulk sample data, we need to build a <strong>sample table</strong> that describes the experimental design and conditions. We’ll call this table <code>samps</code>. We will construct this data frame using the column names of the pseudobulk matrix: for each cell type (four in total), there should be two replicates, which will be reflected as separate rows in <code>samps</code>.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="differential-transcript-usage-dtu.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new data frame with the original column names and extracted sampleID and celltype</span></span>
<span id="cb222-2"><a href="differential-transcript-usage-dtu.html#cb222-2" aria-hidden="true" tabindex="-1"></a>samps <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb222-3"><a href="differential-transcript-usage-dtu.html#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sampleID =</span> sample_data<span class="sc">$</span>colnames,</span>
<span id="cb222-4"><a href="differential-transcript-usage-dtu.html#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">condition =</span> <span class="fu">sapply</span>(split_sample_data, <span class="st">`</span><span class="at">[</span><span class="st">`</span>, <span class="dv">2</span>)</span>
<span id="cb222-5"><a href="differential-transcript-usage-dtu.html#cb222-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb222-6"><a href="differential-transcript-usage-dtu.html#cb222-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-7"><a href="differential-transcript-usage-dtu.html#cb222-7" aria-hidden="true" tabindex="-1"></a>samps<span class="sc">$</span>condition <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(samps<span class="sc">$</span>condition)</span>
<span id="cb222-8"><a href="differential-transcript-usage-dtu.html#cb222-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-9"><a href="differential-transcript-usage-dtu.html#cb222-9" aria-hidden="true" tabindex="-1"></a>samps</span></code></pre></div>
</details>
<pre><code>##                          sampleID          condition
## 1           iso.C1.STC_Stem.cells         Stem.cells
## 2        iso.C2.Day25_Radial.glia        Radial.glia
## 3 iso.C2.Day25_Inhibitory.neurons Inhibitory.neurons
## 4 iso.C2.Day25_Excitatory.neurons Excitatory.neurons
## 5           iso.C4.STC_Stem.cells         Stem.cells
## 6        iso.C5.Day25_Radial.glia        Radial.glia
## 7 iso.C5.Day25_Inhibitory.neurons Inhibitory.neurons
## 8 iso.C5.Day25_Excitatory.neurons Excitatory.neurons</code></pre>
<p>Great! Now we can follow the <strong>IsoformSwitchAnalyzeR</strong> documentation to create a <code>switchAnalyzeRlist</code> and test for DTU across our cell types.</p>
<p>Before generating this object, we first need to subset both the GTF and the count matrix to ensure a <strong>1:1 match</strong> between them—that is, the reference GTF and the count data should contain exactly the same set of transcript (isoform) entries. This alignment is essential for IsoformSwitchAnalyzeR to correctly map counts to the underlying transcript models.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="differential-transcript-usage-dtu.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Before generating a switch list we need to subset both the gtf and counts to ensure we have a 1:1 match </span></span>
<span id="cb224-2"><a href="differential-transcript-usage-dtu.html#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="co">#read in gtf This is the GTF output by flames</span></span>
<span id="cb224-3"><a href="differential-transcript-usage-dtu.html#cb224-3" aria-hidden="true" tabindex="-1"></a>tx2gene <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;./data/muti_sample/isoform_annotated.gtf&quot;</span>)</span>
<span id="cb224-4"><a href="differential-transcript-usage-dtu.html#cb224-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-5"><a href="differential-transcript-usage-dtu.html#cb224-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set row names of pseudo.seurat.isoforms.df to the transcript_id column</span></span>
<span id="cb224-6"><a href="differential-transcript-usage-dtu.html#cb224-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the row names</span></span>
<span id="cb224-7"><a href="differential-transcript-usage-dtu.html#cb224-7" aria-hidden="true" tabindex="-1"></a>rownames_split <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(<span class="fu">rownames</span>(pseudo.seurat.isoforms.df), <span class="st">&quot;-&quot;</span>)</span>
<span id="cb224-8"><a href="differential-transcript-usage-dtu.html#cb224-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Add new columns &#39;transcript_id&#39; and &#39;gene_id&#39; to the data frame</span></span>
<span id="cb224-9"><a href="differential-transcript-usage-dtu.html#cb224-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(pseudo.seurat.isoforms.df) <span class="ot">&lt;-</span> <span class="fu">sapply</span>(rownames_split, <span class="st">`</span><span class="at">[</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb224-10"><a href="differential-transcript-usage-dtu.html#cb224-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-11"><a href="differential-transcript-usage-dtu.html#cb224-11" aria-hidden="true" tabindex="-1"></a><span class="co">#subset to match</span></span>
<span id="cb224-12"><a href="differential-transcript-usage-dtu.html#cb224-12" aria-hidden="true" tabindex="-1"></a>subset_txt2gene <span class="ot">&lt;-</span> tx2gene[tx2gene<span class="sc">$</span>transcript_id <span class="sc">%in%</span> <span class="fu">row.names</span>(pseudo.seurat.isoforms.df), ]</span>
<span id="cb224-13"><a href="differential-transcript-usage-dtu.html#cb224-13" aria-hidden="true" tabindex="-1"></a>subset_cts <span class="ot">&lt;-</span> pseudo.seurat.isoforms.df[<span class="fu">row.names</span>(pseudo.seurat.isoforms.df) <span class="sc">%in%</span> tx2gene<span class="sc">$</span>transcript_id, ]</span>
<span id="cb224-14"><a href="differential-transcript-usage-dtu.html#cb224-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-15"><a href="differential-transcript-usage-dtu.html#cb224-15" aria-hidden="true" tabindex="-1"></a><span class="co"># write gtf as we need it for the bext step</span></span>
<span id="cb224-16"><a href="differential-transcript-usage-dtu.html#cb224-16" aria-hidden="true" tabindex="-1"></a><span class="fu">export</span>(subset_txt2gene, <span class="st">&quot;./output_files/multi_sample_subset/DTU.gtf&quot;</span>, <span class="at">format =</span> <span class="st">&quot;gtf&quot;</span>)</span></code></pre></div>
</details>
</div>
<div id="generating-a-switchlist" class="section level2 hasAnchor" number="12.2">
<h2><span class="header-section-number">12.2</span> Generating a SwitchList<a href="differential-transcript-usage-dtu.html#generating-a-switchlist" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now lets create the switch list:</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="differential-transcript-usage-dtu.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### genrate a switch list</span></span>
<span id="cb225-2"><a href="differential-transcript-usage-dtu.html#cb225-2" aria-hidden="true" tabindex="-1"></a>aSwitchList <span class="ot">&lt;-</span> <span class="fu">importRdata</span>(</span>
<span id="cb225-3"><a href="differential-transcript-usage-dtu.html#cb225-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">isoformCountMatrix   =</span> subset_cts,</span>
<span id="cb225-4"><a href="differential-transcript-usage-dtu.html#cb225-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">isoformRepExpression =</span> subset_cts,</span>
<span id="cb225-5"><a href="differential-transcript-usage-dtu.html#cb225-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">designMatrix         =</span> samps,</span>
<span id="cb225-6"><a href="differential-transcript-usage-dtu.html#cb225-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">isoformExonAnnoation =</span> <span class="st">&quot;./output_files/multi_sample_subset/DTU.gtf&quot;</span>,</span>
<span id="cb225-7"><a href="differential-transcript-usage-dtu.html#cb225-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">isoformNtFasta       =</span> <span class="st">&quot;/data/scratch/users/yairp/Kolf2.1_FLAMESv2/outs/Bambu_NDR_0.75/transcript_assembly.fa&quot;</span>, <span class="co"># provide the FLAMES transcript_output .fasta, it will be found in the flames output fodler</span></span>
<span id="cb225-8"><a href="differential-transcript-usage-dtu.html#cb225-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">showProgress =</span> <span class="cn">TRUE</span>,</span>
<span id="cb225-9"><a href="differential-transcript-usage-dtu.html#cb225-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixStringTieAnnotationProblem =</span> <span class="cn">TRUE</span></span>
<span id="cb225-10"><a href="differential-transcript-usage-dtu.html#cb225-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<pre><code>## Step 1 of 10: Checking data...</code></pre>
<pre><code>## Warning in importRdata(isoformCountMatrix = subset_cts, isoformRepExpression = subset_cts, : Using row.names as &#39;isoform_id&#39; for
## &#39;isoformCountMatrix&#39;. If not suitable you must add them manually.</code></pre>
<pre><code>##     Using row.names as &#39;isoform_id&#39; for &#39;isoformRepExpression&#39;. If not suitable you must add them manually.</code></pre>
<pre><code>## Step 2 of 10: Obtaining annotation...</code></pre>
<pre><code>##     importing GTF (this may take a while)...</code></pre>
<pre><code>## Warning in importRdata(isoformCountMatrix = subset_cts, isoformRepExpression = subset_cts, : We found 2 (0%) unstranded transcripts.
##   These were removed as unstranded transcripts cannot be analysed</code></pre>
<pre><code>## Warning in importRdata(isoformCountMatrix = subset_cts, isoformRepExpression = subset_cts, :    No CDS annotation was found in the GTF files meaning ORFs could not be annotated.
##      (But ORFs can still be predicted with the analyzeORF() function)</code></pre>
<pre><code>##     5823 ( 4.37%) isoforms were removed since they were not expressed in any samples.</code></pre>
<pre><code>## Step 3 of 10: Fixing StringTie gene annoation problems...</code></pre>
<pre><code>##     There were no need to rescue any annotation</code></pre>
<pre><code>## Step 4 of 10: Calculating expression estimates from count data...</code></pre>
<pre><code>##     Skipped as user supplied expression via the &quot;isoformRepExpression&quot; argument...</code></pre>
<pre><code>## Step 5 of 10: Testing for unwanted effects...</code></pre>
<pre><code>##     
##     SVA analysis failed. No unwanted effects were added.</code></pre>
<pre><code>## Warning in importRdata(isoformCountMatrix = subset_cts, isoformRepExpression = subset_cts, : 
## There were estimated unwanted effects in your dataset but the automatic sva run failed.
##     We highly reccomend you run sva yourself, add the nessesary surrogate variables
##     as extra columns in the &quot;designMatrix&quot; and re-run this function</code></pre>
<pre><code>## Step 6 of 10: Batch correcting expression estimates...</code></pre>
<pre><code>##     Skipped as no batch effects were found or annoated...</code></pre>
<pre><code>## Step 7 of 10: Extracting data from each condition...</code></pre>
<pre><code>##   |                                                                                                                                    |                                                                                                                            |   0%  |                                                                                                                                    |===============================                                                                                             |  25%  |                                                                                                                                    |==============================================================                                                              |  50%  |                                                                                                                                    |=============================================================================================                               |  75%  |                                                                                                                                    |============================================================================================================================| 100%</code></pre>
<pre><code>## Step 8 of 10: Making comparisons...</code></pre>
<pre><code>##   |                                                                                                                                    |                                                                                                                            |   0%  |                                                                                                                                    |=====================                                                                                                       |  17%  |                                                                                                                                    |=========================================                                                                                   |  33%  |                                                                                                                                    |==============================================================                                                              |  50%  |                                                                                                                                    |===================================================================================                                         |  67%  |                                                                                                                                    |=======================================================================================================                     |  83%  |                                                                                                                                    |============================================================================================================================| 100%</code></pre>
<pre><code>## Step 9 of 10: Making switchAnalyzeRlist object...</code></pre>
<pre><code>## Step 10 of 10: Guestimating differential usage...</code></pre>
<pre><code>##     The GUESSTIMATED number of genes with differential isoform usage are:</code></pre>
<pre><code>##                                 comparison estimated_genes_with_dtu
## 1 Excitatory.neurons vs Inhibitory.neurons                    0 - 0
## 2         Excitatory.neurons vs Stem.cells               769 - 1282
## 3                Radial.glia vs Stem.cells                165 - 275</code></pre>
<pre><code>## Done</code></pre>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="differential-transcript-usage-dtu.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summary of switch lsit</span></span>
<span id="cb252-2"><a href="differential-transcript-usage-dtu.html#cb252-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aSwitchList)</span></code></pre></div>
</details>
<pre><code>## This switchAnalyzeRlist list contains:
##  127534 isoforms from 29885 genes
##  6 comparison from 4 conditions (in total 8 samples)
## 
## Feature analyzed:
## [1] &quot;ntSequence&quot;</code></pre>
<p>Now that we have our switch list, we apply stringent filtering to remove genes and isoforms that are lowly expressed, as well as isoforms that contribute only a small fraction of a gene’s overall expression. We are deliberately strict here for two reasons:</p>
<ol style="list-style-type: decimal">
<li><p><strong>IsoformSwitchAnalyzeR is designed for bulk data</strong>, so using higher stringency thresholds is generally a safer and more biologically meaningful choice in this context.</p></li>
<li><p><strong>Filtering out isoforms of little consequence</strong> reduces noise, improves the robustness of the DTU testing, and substantially speeds up subsequent analysis steps.</p></li>
</ol>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="differential-transcript-usage-dtu.html#cb254-1" aria-hidden="true" tabindex="-1"></a>aSwitchList_filt <span class="ot">&lt;-</span> <span class="fu">preFilter</span>(</span>
<span id="cb254-2"><a href="differential-transcript-usage-dtu.html#cb254-2" aria-hidden="true" tabindex="-1"></a>  aSwitchList,</span>
<span id="cb254-3"><a href="differential-transcript-usage-dtu.html#cb254-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">geneExpressionCutoff       =</span> <span class="dv">30</span>,   <span class="co"># min avg *gene* expression across samples</span></span>
<span id="cb254-4"><a href="differential-transcript-usage-dtu.html#cb254-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">isoformExpressionCutoff    =</span> <span class="dv">20</span>,    <span class="co"># min isoform expression in at least one condition</span></span>
<span id="cb254-5"><a href="differential-transcript-usage-dtu.html#cb254-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">IFcutoff                   =</span> <span class="fl">0.05</span>, <span class="co"># keep isoforms that contribute &gt;=5% to gene</span></span>
<span id="cb254-6"><a href="differential-transcript-usage-dtu.html#cb254-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">removeSingleIsoformGenes   =</span> <span class="cn">TRUE</span>, <span class="co"># drop genes with only one isoform</span></span>
<span id="cb254-7"><a href="differential-transcript-usage-dtu.html#cb254-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">acceptedGeneBiotype        =</span> <span class="cn">NULL</span>, <span class="co"># or e.g. &quot;protein_coding&quot; if annotated</span></span>
<span id="cb254-8"><a href="differential-transcript-usage-dtu.html#cb254-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">quiet                      =</span> <span class="cn">FALSE</span></span>
<span id="cb254-9"><a href="differential-transcript-usage-dtu.html#cb254-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<pre><code>## The filtering removed 120390 ( 94.4% of ) transcripts. There is now 7144 isoforms left</code></pre>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="differential-transcript-usage-dtu.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aSwitchList_filt)</span></code></pre></div>
</details>
<pre><code>## This switchAnalyzeRlist list contains:
##  7144 isoforms from 2865 genes
##  6 comparison from 4 conditions (in total 8 samples)
## 
## Feature analyzed:
## [1] &quot;ntSequence&quot;</code></pre>
<p>As part of the workflow, we can also add ORF (open reading frame) information to the object. This step can be time-consuming if you have many isoforms, but we recommend running it where possible, as it helps to interpret the potential functional impact of different isoforms in different contexts.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="differential-transcript-usage-dtu.html#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Add ORF info</span></span>
<span id="cb258-2"><a href="differential-transcript-usage-dtu.html#cb258-2" aria-hidden="true" tabindex="-1"></a>aSwitchList_ORF_filt <span class="ot">&lt;-</span> <span class="fu">analyzeORF</span>(<span class="at">switchAnalyzeRlist =</span> aSwitchList_filt, <span class="at">orfMethod =</span> <span class="st">&quot;longest&quot;</span>, <span class="at">showProgress =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</details>
<pre><code>## Step 1 of 3 : Extracting transcript sequences...</code></pre>
<pre><code>## Step 2 of 3 : Locating potential ORFs...</code></pre>
<pre><code>##   |                                                                                                                                    |                                                                                                                            |   0%  |                                                                                                                                    |=                                                                                                                           |   0%  |                                                                                                                                    |=                                                                                                                           |   1%  |                                                                                                                                    |==                                                                                                                          |   1%  |                                                                                                                                    |==                                                                                                                          |   2%  |                                                                                                                                    |===                                                                                                                         |   2%  |                                                                                                                                    |===                                                                                                                         |   3%  |                                                                                                                                    |====                                                                                                                        |   3%  |                                                                                                                                    |====                                                                                                                        |   4%  |                                                                                                                                    |=====                                                                                                                       |   4%  |                                                                                                                                    |======                                                                                                                      |   4%  |                                                                                                                                    |======                                                                                                                      |   5%  |                                                                                                                                    |=======                                                                                                                     |   5%  |                                                                                                                                    |=======                                                                                                                     |   6%  |                                                                                                                                    |========                                                                                                                    |   6%  |                                                                                                                                    |========                                                                                                                    |   7%  |                                                                                                                                    |=========                                                                                                                   |   7%  |                                                                                                                                    |=========                                                                                                                   |   8%  |                                                                                                                                    |==========                                                                                                                  |   8%  |                                                                                                                                    |===========                                                                                                                 |   8%  |                                                                                                                                    |===========                                                                                                                 |   9%  |                                                                                                                                    |============                                                                                                                |   9%  |                                                                                                                                    |============                                                                                                                |  10%  |                                                                                                                                    |=============                                                                                                               |  10%  |                                                                                                                                    |=============                                                                                                               |  11%  |                                                                                                                                    |==============                                                                                                              |  11%  |                                                                                                                                    |==============                                                                                                              |  12%  |                                                                                                                                    |===============                                                                                                             |  12%  |                                                                                                                                    |================                                                                                                            |  12%  |                                                                                                                                    |================                                                                                                            |  13%  |                                                                                                                                    |=================                                                                                                           |  13%  |                                                                                                                                    |=================                                                                                                           |  14%  |                                                                                                                                    |==================                                                                                                          |  14%  |                                                                                                                                    |==================                                                                                                          |  15%  |                                                                                                                                    |===================                                                                                                         |  15%  |                                                                                                                                    |===================                                                                                                         |  16%  |                                                                                                                                    |====================                                                                                                        |  16%  |                                                                                                                                    |====================                                                                                                        |  17%  |                                                                                                                                    |=====================                                                                                                       |  17%  |                                                                                                                                    |======================                                                                                                      |  17%  |                                                                                                                                    |======================                                                                                                      |  18%  |                                                                                                                                    |=======================                                                                                                     |  18%  |                                                                                                                                    |=======================                                                                                                     |  19%  |                                                                                                                                    |========================                                                                                                    |  19%  |                                                                                                                                    |========================                                                                                                    |  20%  |                                                                                                                                    |=========================                                                                                                   |  20%  |                                                                                                                                    |=========================                                                                                                   |  21%  |                                                                                                                                    |==========================                                                                                                  |  21%  |                                                                                                                                    |===========================                                                                                                 |  21%  |                                                                                                                                    |===========================                                                                                                 |  22%  |                                                                                                                                    |============================                                                                                                |  22%  |                                                                                                                                    |============================                                                                                                |  23%  |                                                                                                                                    |=============================                                                                                               |  23%  |                                                                                                                                    |=============================                                                                                               |  24%  |                                                                                                                                    |==============================                                                                                              |  24%  |                                                                                                                                    |==============================                                                                                              |  25%  |                                                                                                                                    |===============================                                                                                             |  25%  |                                                                                                                                    |================================                                                                                            |  25%  |                                                                                                                                    |================================                                                                                            |  26%  |                                                                                                                                    |=================================                                                                                           |  26%  |                                                                                                                                    |=================================                                                                                           |  27%  |                                                                                                                                    |==================================                                                                                          |  27%  |                                                                                                                                    |==================================                                                                                          |  28%  |                                                                                                                                    |===================================                                                                                         |  28%  |                                                                                                                                    |===================================                                                                                         |  29%  |                                                                                                                                    |====================================                                                                                        |  29%  |                                                                                                                                    |=====================================                                                                                       |  29%  |                                                                                                                                    |=====================================                                                                                       |  30%  |                                                                                                                                    |======================================                                                                                      |  30%  |                                                                                                                                    |======================================                                                                                      |  31%  |                                                                                                                                    |=======================================                                                                                     |  31%  |                                                                                                                                    |=======================================                                                                                     |  32%  |                                                                                                                                    |========================================                                                                                    |  32%  |                                                                                                                                    |========================================                                                                                    |  33%  |                                                                                                                                    |=========================================                                                                                   |  33%  |                                                                                                                                    |==========================================                                                                                  |  33%  |                                                                                                                                    |==========================================                                                                                  |  34%  |                                                                                                                                    |===========================================                                                                                 |  34%  |                                                                                                                                    |===========================================                                                                                 |  35%  |                                                                                                                                    |============================================                                                                                |  35%  |                                                                                                                                    |============================================                                                                                |  36%  |                                                                                                                                    |=============================================                                                                               |  36%  |                                                                                                                                    |=============================================                                                                               |  37%  |                                                                                                                                    |==============================================                                                                              |  37%  |                                                                                                                                    |==============================================                                                                              |  38%  |                                                                                                                                    |===============================================                                                                             |  38%  |                                                                                                                                    |================================================                                                                            |  38%  |                                                                                                                                    |================================================                                                                            |  39%  |                                                                                                                                    |=================================================                                                                           |  39%  |                                                                                                                                    |=================================================                                                                           |  40%  |                                                                                                                                    |==================================================                                                                          |  40%  |                                                                                                                                    |==================================================                                                                          |  41%  |                                                                                                                                    |===================================================                                                                         |  41%  |                                                                                                                                    |===================================================                                                                         |  42%  |                                                                                                                                    |====================================================                                                                        |  42%  |                                                                                                                                    |=====================================================                                                                       |  42%  |                                                                                                                                    |=====================================================                                                                       |  43%  |                                                                                                                                    |======================================================                                                                      |  43%  |                                                                                                                                    |======================================================                                                                      |  44%  |                                                                                                                                    |=======================================================                                                                     |  44%  |                                                                                                                                    |=======================================================                                                                     |  45%  |                                                                                                                                    |========================================================                                                                    |  45%  |                                                                                                                                    |========================================================                                                                    |  46%  |                                                                                                                                    |=========================================================                                                                   |  46%  |                                                                                                                                    |==========================================================                                                                  |  46%  |                                                                                                                                    |==========================================================                                                                  |  47%  |                                                                                                                                    |===========================================================                                                                 |  47%  |                                                                                                                                    |===========================================================                                                                 |  48%  |                                                                                                                                    |============================================================                                                                |  48%  |                                                                                                                                    |============================================================                                                                |  49%  |                                                                                                                                    |=============================================================                                                               |  49%  |                                                                                                                                    |=============================================================                                                               |  50%  |                                                                                                                                    |==============================================================                                                              |  50%  |                                                                                                                                    |===============================================================                                                             |  50%  |                                                                                                                                    |===============================================================                                                             |  51%  |                                                                                                                                    |================================================================                                                            |  51%  |                                                                                                                                    |================================================================                                                            |  52%  |                                                                                                                                    |=================================================================                                                           |  52%  |                                                                                                                                    |=================================================================                                                           |  53%  |                                                                                                                                    |==================================================================                                                          |  53%  |                                                                                                                                    |==================================================================                                                          |  54%  |                                                                                                                                    |===================================================================                                                         |  54%  |                                                                                                                                    |====================================================================                                                        |  54%  |                                                                                                                                    |====================================================================                                                        |  55%  |                                                                                                                                    |=====================================================================                                                       |  55%  |                                                                                                                                    |=====================================================================                                                       |  56%  |                                                                                                                                    |======================================================================                                                      |  56%  |                                                                                                                                    |======================================================================                                                      |  57%  |                                                                                                                                    |=======================================================================                                                     |  57%  |                                                                                                                                    |=======================================================================                                                     |  58%  |                                                                                                                                    |========================================================================                                                    |  58%  |                                                                                                                                    |=========================================================================                                                   |  58%  |                                                                                                                                    |=========================================================================                                                   |  59%  |                                                                                                                                    |==========================================================================                                                  |  59%  |                                                                                                                                    |==========================================================================                                                  |  60%  |                                                                                                                                    |===========================================================================                                                 |  60%  |                                                                                                                                    |===========================================================================                                                 |  61%  |                                                                                                                                    |============================================================================                                                |  61%  |                                                                                                                                    |============================================================================                                                |  62%  |                                                                                                                                    |=============================================================================                                               |  62%  |                                                                                                                                    |==============================================================================                                              |  62%  |                                                                                                                                    |==============================================================================                                              |  63%  |                                                                                                                                    |===============================================================================                                             |  63%  |                                                                                                                                    |===============================================================================                                             |  64%  |                                                                                                                                    |================================================================================                                            |  64%  |                                                                                                                                    |================================================================================                                            |  65%  |                                                                                                                                    |=================================================================================                                           |  65%  |                                                                                                                                    |=================================================================================                                           |  66%  |                                                                                                                                    |==================================================================================                                          |  66%  |                                                                                                                                    |==================================================================================                                          |  67%  |                                                                                                                                    |===================================================================================                                         |  67%  |                                                                                                                                    |====================================================================================                                        |  67%  |                                                                                                                                    |====================================================================================                                        |  68%  |                                                                                                                                    |=====================================================================================                                       |  68%  |                                                                                                                                    |=====================================================================================                                       |  69%  |                                                                                                                                    |======================================================================================                                      |  69%  |                                                                                                                                    |======================================================================================                                      |  70%  |                                                                                                                                    |=======================================================================================                                     |  70%  |                                                                                                                                    |=======================================================================================                                     |  71%  |                                                                                                                                    |========================================================================================                                    |  71%  |                                                                                                                                    |=========================================================================================                                   |  71%  |                                                                                                                                    |=========================================================================================                                   |  72%  |                                                                                                                                    |==========================================================================================                                  |  72%  |                                                                                                                                    |==========================================================================================                                  |  73%  |                                                                                                                                    |===========================================================================================                                 |  73%  |                                                                                                                                    |===========================================================================================                                 |  74%  |                                                                                                                                    |============================================================================================                                |  74%  |                                                                                                                                    |============================================================================================                                |  75%  |                                                                                                                                    |=============================================================================================                               |  75%  |                                                                                                                                    |==============================================================================================                              |  75%  |                                                                                                                                    |==============================================================================================                              |  76%  |                                                                                                                                    |===============================================================================================                             |  76%  |                                                                                                                                    |===============================================================================================                             |  77%  |                                                                                                                                    |================================================================================================                            |  77%  |                                                                                                                                    |================================================================================================                            |  78%  |                                                                                                                                    |=================================================================================================                           |  78%  |                                                                                                                                    |=================================================================================================                           |  79%  |                                                                                                                                    |==================================================================================================                          |  79%  |                                                                                                                                    |===================================================================================================                         |  79%  |                                                                                                                                    |===================================================================================================                         |  80%  |                                                                                                                                    |====================================================================================================                        |  80%  |                                                                                                                                    |====================================================================================================                        |  81%  |                                                                                                                                    |=====================================================================================================                       |  81%  |                                                                                                                                    |=====================================================================================================                       |  82%  |                                                                                                                                    |======================================================================================================                      |  82%  |                                                                                                                                    |======================================================================================================                      |  83%  |                                                                                                                                    |=======================================================================================================                     |  83%  |                                                                                                                                    |========================================================================================================                    |  83%  |                                                                                                                                    |========================================================================================================                    |  84%  |                                                                                                                                    |=========================================================================================================                   |  84%  |                                                                                                                                    |=========================================================================================================                   |  85%  |                                                                                                                                    |==========================================================================================================                  |  85%  |                                                                                                                                    |==========================================================================================================                  |  86%  |                                                                                                                                    |===========================================================================================================                 |  86%  |                                                                                                                                    |===========================================================================================================                 |  87%  |                                                                                                                                    |============================================================================================================                |  87%  |                                                                                                                                    |============================================================================================================                |  88%  |                                                                                                                                    |=============================================================================================================               |  88%  |                                                                                                                                    |==============================================================================================================              |  88%  |                                                                                                                                    |==============================================================================================================              |  89%  |                                                                                                                                    |===============================================================================================================             |  89%  |                                                                                                                                    |===============================================================================================================             |  90%  |                                                                                                                                    |================================================================================================================            |  90%  |                                                                                                                                    |================================================================================================================            |  91%  |                                                                                                                                    |=================================================================================================================           |  91%  |                                                                                                                                    |=================================================================================================================           |  92%  |                                                                                                                                    |==================================================================================================================          |  92%  |                                                                                                                                    |===================================================================================================================         |  92%  |                                                                                                                                    |===================================================================================================================         |  93%  |                                                                                                                                    |====================================================================================================================        |  93%  |                                                                                                                                    |====================================================================================================================        |  94%  |                                                                                                                                    |=====================================================================================================================       |  94%  |                                                                                                                                    |=====================================================================================================================       |  95%  |                                                                                                                                    |======================================================================================================================      |  95%  |                                                                                                                                    |======================================================================================================================      |  96%  |                                                                                                                                    |=======================================================================================================================     |  96%  |                                                                                                                                    |========================================================================================================================    |  96%  |                                                                                                                                    |========================================================================================================================    |  97%  |                                                                                                                                    |=========================================================================================================================   |  97%  |                                                                                                                                    |=========================================================================================================================   |  98%  |                                                                                                                                    |==========================================================================================================================  |  98%  |                                                                                                                                    |==========================================================================================================================  |  99%  |                                                                                                                                    |=========================================================================================================================== |  99%  |                                                                                                                                    |=========================================================================================================================== | 100%  |                                                                                                                                    |============================================================================================================================| 100%</code></pre>
<pre><code>## Step 3 of 3 : Scanning for PTCs...</code></pre>
<pre><code>## 7117 putative ORFs were identified, analyzed and added.</code></pre>
<pre><code>## Done</code></pre>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="differential-transcript-usage-dtu.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(</span></span>
<span id="cb265-2"><a href="differential-transcript-usage-dtu.html#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  object = aSwitchList_ORF,</span></span>
<span id="cb265-3"><a href="differential-transcript-usage-dtu.html#cb265-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  file   = &quot;./output_files/multi_sample_subset/DTU_switch_list_ORF.rds&quot;</span></span>
<span id="cb265-4"><a href="differential-transcript-usage-dtu.html#cb265-4" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span></code></pre></div>
</details>
<p>Lets add in gene symbols to the object so we can easily read what genes are switching</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="differential-transcript-usage-dtu.html#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Add gene symbol to switch lsit </span></span>
<span id="cb266-2"><a href="differential-transcript-usage-dtu.html#cb266-2" aria-hidden="true" tabindex="-1"></a>resource_table <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./output_files/ref_files/isoform_gene_dict_mutlisample_subset.csv&quot;</span>, <span class="at">header =</span> T)</span>
<span id="cb266-3"><a href="differential-transcript-usage-dtu.html#cb266-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-4"><a href="differential-transcript-usage-dtu.html#cb266-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the isoform features list</span></span>
<span id="cb266-5"><a href="differential-transcript-usage-dtu.html#cb266-5" aria-hidden="true" tabindex="-1"></a>isoform_features <span class="ot">&lt;-</span> aSwitchList_ORF_filt[[<span class="st">&quot;isoformFeatures&quot;</span>]]</span>
<span id="cb266-6"><a href="differential-transcript-usage-dtu.html#cb266-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-7"><a href="differential-transcript-usage-dtu.html#cb266-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Use match to fill in the &#39;gene_name&#39; based on &#39;gene_id&#39;</span></span>
<span id="cb266-8"><a href="differential-transcript-usage-dtu.html#cb266-8" aria-hidden="true" tabindex="-1"></a>isoform_features[[<span class="st">&quot;gene_name&quot;</span>]] <span class="ot">&lt;-</span> resource_table<span class="sc">$</span>gene_symbol[<span class="fu">match</span>(isoform_features[[<span class="st">&quot;gene_id&quot;</span>]], resource_table<span class="sc">$</span>gene_id)]</span>
<span id="cb266-9"><a href="differential-transcript-usage-dtu.html#cb266-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-10"><a href="differential-transcript-usage-dtu.html#cb266-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the updated isoformFeatures back into the main list</span></span>
<span id="cb266-11"><a href="differential-transcript-usage-dtu.html#cb266-11" aria-hidden="true" tabindex="-1"></a>aSwitchList_ORF_filt[[<span class="st">&quot;isoformFeatures&quot;</span>]] <span class="ot">&lt;-</span> isoform_features</span></code></pre></div>
</details>
<p>After all of this, we can finally perform the statistical test for DTU. This step can be time-consuming, especially if there are many comparisons to make or a large number of samples to test.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="differential-transcript-usage-dtu.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute Switch testing </span></span>
<span id="cb267-2"><a href="differential-transcript-usage-dtu.html#cb267-2" aria-hidden="true" tabindex="-1"></a>SwitchListAnalyzed <span class="ot">&lt;-</span> <span class="fu">isoformSwitchTestDEXSeq</span>(</span>
<span id="cb267-3"><a href="differential-transcript-usage-dtu.html#cb267-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">switchAnalyzeRlist =</span> aSwitchList_ORF_filt,</span>
<span id="cb267-4"><a href="differential-transcript-usage-dtu.html#cb267-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">reduceToSwitchingGenes=</span><span class="cn">FALSE</span>,</span>
<span id="cb267-5"><a href="differential-transcript-usage-dtu.html#cb267-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">reduceFurtherToGenesWithConsequencePotential=</span><span class="cn">FALSE</span>,</span>
<span id="cb267-6"><a href="differential-transcript-usage-dtu.html#cb267-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.01</span>,</span>
<span id="cb267-7"><a href="differential-transcript-usage-dtu.html#cb267-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dIFcutoff =</span> <span class="fl">0.25</span>,</span>
<span id="cb267-8"><a href="differential-transcript-usage-dtu.html#cb267-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">onlySigIsoforms=</span><span class="cn">FALSE</span></span>
<span id="cb267-9"><a href="differential-transcript-usage-dtu.html#cb267-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<pre><code>## Step 1 of 2: Testing each pairwise comparisons with DEXSeq (this might be a bit slow)...</code></pre>
<pre><code>##     Estimated run time is: 9.5 min</code></pre>
<pre><code>##   |                                                                                                                                    |                                                                                                                            |   0%  |                                                                                                                                    |=====================                                                                                                       |  17%  |                                                                                                                                    |=========================================                                                                                   |  33%  |                                                                                                                                    |==============================================================                                                              |  50%  |                                                                                                                                    |===================================================================================                                         |  67%  |                                                                                                                                    |=======================================================================================================                     |  83%  |                                                                                                                                    |============================================================================================================================| 100%</code></pre>
<pre><code>## Step 2 of 2: Integrating result into switchAnalyzeRlist...</code></pre>
<pre><code>##     Isoform switch analysis was performed for 9033 gene comparisons (100%).</code></pre>
<pre><code>## Total runtime: 1 min</code></pre>
<pre><code>## Done</code></pre>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="differential-transcript-usage-dtu.html#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(&quot;./output_files/multi_sample_subset/DTU_SwitchListAnalyzed.rds&quot;, object = SwitchListAnalyzed)</span></span></code></pre></div>
</details>
</div>
<div id="visualising-dtu-hits" class="section level2 hasAnchor" number="12.3">
<h2><span class="header-section-number">12.3</span> Visualising DTU Hits<a href="differential-transcript-usage-dtu.html#visualising-dtu-hits" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Lets Investigate the results. First we can look at the numebr of DTU hits across each condition.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="differential-transcript-usage-dtu.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extractSwitchSummary</span>(SwitchListAnalyzed)</span></code></pre></div>
</details>
<pre><code>##                                 Comparison nrIsoforms nrSwitches nrGenes
## 1 Excitatory.neurons vs Inhibitory.neurons          3          2       2
## 2        Excitatory.neurons vs Radial.glia        181        114     113
## 3         Excitatory.neurons vs Stem.cells        555        321     325
## 4        Inhibitory.neurons vs Radial.glia         88         47      55
## 5         Inhibitory.neurons vs Stem.cells        543        293     337
## 6                Radial.glia vs Stem.cells        503        252     310
## 7                                 Combined       1159        670     651</code></pre>
<p>We can then extract some of the top (most significant) DTU events and visualise them using the built-in plotting functions in the <strong>IsoformSwitchAnalyzeR</strong> package. These functions make it straightforward to inspect individual genes and their switching isoforms in more detail.</p>
<p>If you run this function bellow you will generate the top 5 DTU events for each condition.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="differential-transcript-usage-dtu.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extractTopSwitches</span>(SwitchListAnalyzed, <span class="at">n=</span><span class="dv">20</span>)</span>
<span id="cb278-2"><a href="differential-transcript-usage-dtu.html#cb278-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-3"><a href="differential-transcript-usage-dtu.html#cb278-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Main results file</span></span>
<span id="cb278-4"><a href="differential-transcript-usage-dtu.html#cb278-4" aria-hidden="true" tabindex="-1"></a>iso_feat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(SwitchListAnalyzed<span class="sc">$</span>isoformFeatures)</span>
<span id="cb278-5"><a href="differential-transcript-usage-dtu.html#cb278-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(SwitchListAnalyzed<span class="sc">$</span>isoformFeatures, <span class="st">&quot;stem_gaba_dtu.csv&quot;</span>)</span>
<span id="cb278-6"><a href="differential-transcript-usage-dtu.html#cb278-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-7"><a href="differential-transcript-usage-dtu.html#cb278-7" aria-hidden="true" tabindex="-1"></a><span class="co">#output switch plots for all</span></span>
<span id="cb278-8"><a href="differential-transcript-usage-dtu.html#cb278-8" aria-hidden="true" tabindex="-1"></a><span class="fu">switchPlotTopSwitches</span>(</span>
<span id="cb278-9"><a href="differential-transcript-usage-dtu.html#cb278-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">switchAnalyzeRlist =</span> SwitchListAnalyzed, </span>
<span id="cb278-10"><a href="differential-transcript-usage-dtu.html#cb278-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">5</span>,                  </span>
<span id="cb278-11"><a href="differential-transcript-usage-dtu.html#cb278-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">splitFunctionalConsequences =</span> F,</span>
<span id="cb278-12"><a href="differential-transcript-usage-dtu.html#cb278-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">filterForConsequences =</span> <span class="cn">FALSE</span>, <span class="co">#this could be changed to add in consequeces</span></span>
<span id="cb278-13"><a href="differential-transcript-usage-dtu.html#cb278-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">fileType =</span> <span class="st">&quot;pdf&quot;</span>,                                 </span>
<span id="cb278-14"><a href="differential-transcript-usage-dtu.html#cb278-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">pathToOutput =</span> <span class="st">&quot;./output_files/multi_sample_subset/&quot;</span>,</span>
<span id="cb278-15"><a href="differential-transcript-usage-dtu.html#cb278-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.01</span></span>
<span id="cb278-16"><a href="differential-transcript-usage-dtu.html#cb278-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<p>Let’s explore one example in more detail. Here, we compare <strong>stem cells</strong> to <strong>radial glia</strong> and focus on one of the most significant DTU hits, <strong>RPS24</strong>. We can visualise this using a switch plot.</p>
<p>The switch plot is composed of several panels. At the top, we see the <strong>isoform structures</strong> for the two RPS24 isoforms tested. Notably, ENST00000613865.5 is missing the penultimate exon, and the two isoforms have different ORFs, yet both are classified as coding. Below, the <strong>bar charts</strong> summarise overall gene expression and isoform-level expression across conditions. The panel on the right shows the key result: <strong>isoform usage</strong> (relative proportion) in each condition. In this example, stem cells use a higher proportion of ENST00000613865.5, whereas radial glia preferentially use ENST00000372360.9, illustrating a clear isoform switch between these two cell types.</p>
<pre><code>## Omitting toplogy visualization as it has not been added. You can add this analysis through analyzeDeepTMHMM(). To avoid this message set &quot;plotTopology=FALSE&quot;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-43-1.png" width="768" /></p>
<p>This can be visualised and verified using our Seurat plotting functions. Let’s first look at <strong>gene-level expression</strong> of RPS24. As you can see below, RPS24 is expressed ubiquitously and appears, at first glance, to be a fairly unremarkable gene with expression detected across all cell types.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="differential-transcript-usage-dtu.html#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="fu">FeaturePlot</span>(obj, <span class="at">features =</span> <span class="st">&quot;RPS24&quot;</span>, <span class="at">reduction =</span> <span class="st">&quot;umap.harm&quot;</span>)</span></code></pre></div>
</details>
<p><img src="bookdownproj_files/figure-html/DTU_plots_2,%20setup-1.png" width="384" /></p>
<p>Let’s dive in and plot the isoforms from the switch plot to see what is really going on. When we visualise these isoforms, we observe a clear separation in isoform expression between stem cells and radial glia. Stem cells appear to use a mixture of both isoforms, whereas radial glia are much more selective and predominantly express ENST00000372360.9. (It is important to note that additional RPS24 isoforms exist in the data, but they were not included in our DTU test or in the plots shown here.)</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="differential-transcript-usage-dtu.html#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">FeaturePlot</span>(obj, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">&quot;ENST00000372360.9-RPS24&quot;</span>,  <span class="st">&quot;ENST00000613865.5-RPS24&quot;</span>), <span class="at">reduction =</span> <span class="st">&quot;umap.harm&quot;</span>) </span></code></pre></div>
</details>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-44-1.png" width="768" /></p>
</div>
<div id="final-thoughts" class="section level2 hasAnchor" number="12.4">
<h2><span class="header-section-number">12.4</span> Final thoughts<a href="differential-transcript-usage-dtu.html#final-thoughts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>DTU analysis is a powerful and exciting way to explore how isoforms are used in different contexts. Once you have the switch list we generated here, you can systematically explore many alternative DTU hits, inspect structural differences between isoforms, and assess whether particular transcripts are likely coding or non-coding. Together, these insights can greatly strengthen our understanding of isoform dynamics across cell types and conditions. Combined with trajectory analysis and standard differential expression, DTU provides yet another complementary lens for exploring the isoform landscape at single-cell resolution.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="conclusion.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/sefi196/FLAMESv2_LR_sc_tutorial/edit/main/13_Differential_Transcript_Usage.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": "https://github.com/sefi196/FLAMESv2_LR_sc_tutorial/blob/main/13_Differential_Transcript_Usage.Rmd",
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
