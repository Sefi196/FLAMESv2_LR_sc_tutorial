<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Finding differentially expressed genes and isoforms | Citations and Session info</title>
  <meta name="description" content="Chapter 5 Finding differentially expressed genes and isoforms | Citations and Session info" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Finding differentially expressed genes and isoforms | Citations and Session info" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Finding differentially expressed genes and isoforms | Citations and Session info" />
  
  
  

<meta name="author" content="Sefi Prawer" />


<meta name="date" content="2025-01-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="add-isoform-counts-to-seurat-object.html"/>
<link rel="next" href="citations-and-session-info.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">FLAMES_tutorial</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>2</b> Setup</a>
<ul>
<li class="chapter" data-level="2.1" data-path="setup.html"><a href="setup.html#load-in-required-packages"><i class="fa fa-check"></i><b>2.1</b> load in required packages</a></li>
<li class="chapter" data-level="2.2" data-path="setup.html"><a href="setup.html#creating-resource-files."><i class="fa fa-check"></i><b>2.2</b> Creating resource files.</a></li>
<li class="chapter" data-level="2.3" data-path="setup.html"><a href="setup.html#convert-count-matrices-from-gene-id-to-gene-symbol"><i class="fa fa-check"></i><b>2.3</b> Convert count matrices from Gene ID to gene Symbol</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html"><a href="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html"><i class="fa fa-check"></i><b>3</b> Removing sources of unwanted noise from the single cell dataset</a>
<ul>
<li class="chapter" data-level="3.0.1" data-path="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html"><a href="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html#empty-droplets"><i class="fa fa-check"></i><b>3.0.1</b> Empty droplets</a></li>
<li class="chapter" data-level="3.1" data-path="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html"><a href="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html#removing-ambient-rna-contamination"><i class="fa fa-check"></i><b>3.1</b> Removing ambient RNA contamination</a></li>
<li class="chapter" data-level="3.2" data-path="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html"><a href="removing-sources-of-unwanted-noise-from-the-single-cell-dataset.html#standard-gene-qc-to-remove-low-quality-cells"><i class="fa fa-check"></i><b>3.2</b> Standard gene QC to remove low quality cells</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="add-isoform-counts-to-seurat-object.html"><a href="add-isoform-counts-to-seurat-object.html"><i class="fa fa-check"></i><b>4</b> Add isoform counts to Seurat object</a></li>
<li class="chapter" data-level="5" data-path="finding-differentially-expressed-genes-and-isoforms.html"><a href="finding-differentially-expressed-genes-and-isoforms.html"><i class="fa fa-check"></i><b>5</b> Finding differentially expressed genes and isoforms</a>
<ul>
<li class="chapter" data-level="5.1" data-path="finding-differentially-expressed-genes-and-isoforms.html"><a href="finding-differentially-expressed-genes-and-isoforms.html#differentially-expressed-genes-by-cluster-identity"><i class="fa fa-check"></i><b>5.1</b> Differentially expressed genes by cluster identity</a></li>
<li class="chapter" data-level="5.2" data-path="finding-differentially-expressed-genes-and-isoforms.html"><a href="finding-differentially-expressed-genes-and-isoforms.html#identifying-cell-types"><i class="fa fa-check"></i><b>5.2</b> Identifying cell types</a></li>
<li class="chapter" data-level="5.3" data-path="finding-differentially-expressed-genes-and-isoforms.html"><a href="finding-differentially-expressed-genes-and-isoforms.html#de-genes-and-isofroms-based-on-annotaed-cell-types."><i class="fa fa-check"></i><b>5.3</b> DE genes and isofroms based on annotaed cell types.</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="finding-differentially-expressed-genes-and-isoforms.html"><a href="finding-differentially-expressed-genes-and-isoforms.html#volcano-plots"><i class="fa fa-check"></i><b>5.3.1</b> Volcano plots</a></li>
<li class="chapter" data-level="5.3.2" data-path="finding-differentially-expressed-genes-and-isoforms.html"><a href="finding-differentially-expressed-genes-and-isoforms.html#gene-set-enrichemt"><i class="fa fa-check"></i><b>5.3.2</b> Gene Set enrichemt</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="finding-differentially-expressed-genes-and-isoforms.html"><a href="finding-differentially-expressed-genes-and-isoforms.html#finding-isofrms-of-interest"><i class="fa fa-check"></i><b>5.4</b> Finding isofrms of interest</a></li>
<li class="chapter" data-level="5.5" data-path="finding-differentially-expressed-genes-and-isoforms.html"><a href="finding-differentially-expressed-genes-and-isoforms.html#section"><i class="fa fa-check"></i><b>5.5</b> </a></li>
<li class="chapter" data-level="5.6" data-path="finding-differentially-expressed-genes-and-isoforms.html"><a href="finding-differentially-expressed-genes-and-isoforms.html#plotting-with-ditoplot"><i class="fa fa-check"></i><b>5.6</b> plotting with ditoplot</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="citations-and-session-info.html"><a href="citations-and-session-info.html"><i class="fa fa-check"></i><b>6</b> Citations and Session info</a>
<ul>
<li class="chapter" data-level="6.1" data-path="citations-and-session-info.html"><a href="citations-and-session-info.html#citations"><i class="fa fa-check"></i><b>6.1</b> Citations</a></li>
<li class="chapter" data-level="6.2" data-path="citations-and-session-info.html"><a href="citations-and-session-info.html#session-info"><i class="fa fa-check"></i><b>6.2</b> Session info</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Citations and Session info</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="finding-differentially-expressed-genes-and-isoforms" class="section level1 hasAnchor" number="5" style="gray">
<h1><span class="header-section-number">Chapter 5</span> Finding differentially expressed genes and isoforms<a href="finding-differentially-expressed-genes-and-isoforms.html#finding-differentially-expressed-genes-and-isoforms" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<hr />
<div id="differentially-expressed-genes-by-cluster-identity" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Differentially expressed genes by cluster identity<a href="finding-differentially-expressed-genes-and-isoforms.html#differentially-expressed-genes-by-cluster-identity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>first we will look at marker genes for each cluster. This will help us identify which genes are DE in each cluster and indicate which cell type each cluster belongs to. We will also look at DE isoforms using the same methodology</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Find markers for all clusters using the &quot;RNA&quot; and &quot;iso&quot; assay</span></span>
<span id="cb93-2"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb93-3" aria-hidden="true" tabindex="-1"></a>all_markers_gene <span class="ot">&lt;-</span> <span class="fu">FindAllMarkers</span>(seu_obj, <span class="at">assay =</span> <span class="st">&quot;RNA&quot;</span>, <span class="at">do.print =</span> <span class="cn">TRUE</span>,</span>
<span id="cb93-4"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb93-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">logfc.threshold =</span> <span class="fl">0.5</span>, <span class="at">min.pct =</span> <span class="fl">0.20</span>, <span class="at">only.pos =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(p_val_adj <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb93-5"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb93-6" aria-hidden="true" tabindex="-1"></a>all_markers_iso <span class="ot">&lt;-</span> <span class="fu">FindAllMarkers</span>(seu_obj, <span class="at">assay =</span> <span class="st">&quot;iso&quot;</span>, <span class="at">do.print =</span> <span class="cn">TRUE</span>,</span>
<span id="cb93-7"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb93-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">logfc.threshold =</span> <span class="fl">0.5</span>, <span class="at">min.pct =</span> <span class="fl">0.20</span>, <span class="at">only.pos =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(p_val_adj <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb93-8"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="co">#save the list of DE genes </span></span>
<span id="cb93-10"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(all_markers_gene, <span class="st">&quot;./output_files/DE/all_markers_one_gene.csv&quot;</span>)</span>
<span id="cb93-11"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(all_markers_iso, <span class="st">&quot;./output_files/DE/all_markers_one_iso.csv&quot;</span>)</span></code></pre></div>
</details>
<p>#notes - could add other DE options maybe add this later</p>
</div>
<div id="identifying-cell-types" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Identifying cell types<a href="finding-differentially-expressed-genes-and-isoforms.html#identifying-cell-types" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Based on these differentially expressed (DE) genes, we can identify the cell types present in our sample. This process is often complex and requires prior knowledge of cell markers as well as an understanding of the cell types expected in the sample. An alternative approach is to use automated cell type identification tools. In this tutorial, we will use <strong>scType</strong> [ref]. However, it is important to note that the accuracy of automated tools varies and depends heavily on the reference database they utilize. Therefore, it is recommended to use a combination of methods to cross-validate cell type identification and ensure robust results.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load libraries from sctype</span></span>
<span id="cb94-2"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">c</span>(<span class="st">&quot;ggraph&quot;</span>,<span class="st">&quot;igraph&quot;</span>,<span class="st">&quot;tidyverse&quot;</span>, <span class="st">&quot;data.tree&quot;</span>), library, <span class="at">character.only =</span> T)</span></code></pre></div>
</details>
<pre><code>## [[1]]
##  [1] &quot;EnhancedVolcano&quot;      &quot;ggrepel&quot;              &quot;HGNChelper&quot;           &quot;data.tree&quot;            &quot;igraph&quot;              
##  [6] &quot;ggraph&quot;               &quot;parallel&quot;             &quot;SeuratWrappers&quot;       &quot;monocle3&quot;             &quot;ROCR&quot;                
## [11] &quot;KernSmooth&quot;           &quot;fields&quot;               &quot;viridisLite&quot;          &quot;spam&quot;                 &quot;lubridate&quot;           
## [16] &quot;forcats&quot;              &quot;dplyr&quot;                &quot;purrr&quot;                &quot;readr&quot;                &quot;tidyr&quot;               
## [21] &quot;tibble&quot;               &quot;ggplot2&quot;              &quot;tidyverse&quot;            &quot;patchwork&quot;            &quot;grid&quot;                
## [26] &quot;cowplot&quot;              &quot;stringr&quot;              &quot;DoubletFinder&quot;        &quot;celda&quot;                &quot;Matrix&quot;              
## [31] &quot;BiocParallel&quot;         &quot;data.table&quot;           &quot;gridExtra&quot;            &quot;DropletUtils&quot;         &quot;SingleCellExperiment&quot;
## [36] &quot;SummarizedExperiment&quot; &quot;Biobase&quot;              &quot;MatrixGenerics&quot;       &quot;matrixStats&quot;          &quot;Seurat&quot;              
## [41] &quot;SeuratObject&quot;         &quot;sp&quot;                   &quot;rtracklayer&quot;          &quot;GenomicRanges&quot;        &quot;GenomeInfoDb&quot;        
## [46] &quot;IRanges&quot;              &quot;S4Vectors&quot;            &quot;BiocGenerics&quot;         &quot;stats4&quot;               &quot;stats&quot;               
## [51] &quot;graphics&quot;             &quot;grDevices&quot;            &quot;utils&quot;                &quot;datasets&quot;             &quot;methods&quot;             
## [56] &quot;base&quot;                
## 
## [[2]]
##  [1] &quot;EnhancedVolcano&quot;      &quot;ggrepel&quot;              &quot;HGNChelper&quot;           &quot;data.tree&quot;            &quot;igraph&quot;              
##  [6] &quot;ggraph&quot;               &quot;parallel&quot;             &quot;SeuratWrappers&quot;       &quot;monocle3&quot;             &quot;ROCR&quot;                
## [11] &quot;KernSmooth&quot;           &quot;fields&quot;               &quot;viridisLite&quot;          &quot;spam&quot;                 &quot;lubridate&quot;           
## [16] &quot;forcats&quot;              &quot;dplyr&quot;                &quot;purrr&quot;                &quot;readr&quot;                &quot;tidyr&quot;               
## [21] &quot;tibble&quot;               &quot;ggplot2&quot;              &quot;tidyverse&quot;            &quot;patchwork&quot;            &quot;grid&quot;                
## [26] &quot;cowplot&quot;              &quot;stringr&quot;              &quot;DoubletFinder&quot;        &quot;celda&quot;                &quot;Matrix&quot;              
## [31] &quot;BiocParallel&quot;         &quot;data.table&quot;           &quot;gridExtra&quot;            &quot;DropletUtils&quot;         &quot;SingleCellExperiment&quot;
## [36] &quot;SummarizedExperiment&quot; &quot;Biobase&quot;              &quot;MatrixGenerics&quot;       &quot;matrixStats&quot;          &quot;Seurat&quot;              
## [41] &quot;SeuratObject&quot;         &quot;sp&quot;                   &quot;rtracklayer&quot;          &quot;GenomicRanges&quot;        &quot;GenomeInfoDb&quot;        
## [46] &quot;IRanges&quot;              &quot;S4Vectors&quot;            &quot;BiocGenerics&quot;         &quot;stats4&quot;               &quot;stats&quot;               
## [51] &quot;graphics&quot;             &quot;grDevices&quot;            &quot;utils&quot;                &quot;datasets&quot;             &quot;methods&quot;             
## [56] &quot;base&quot;                
## 
## [[3]]
##  [1] &quot;EnhancedVolcano&quot;      &quot;ggrepel&quot;              &quot;HGNChelper&quot;           &quot;data.tree&quot;            &quot;igraph&quot;              
##  [6] &quot;ggraph&quot;               &quot;parallel&quot;             &quot;SeuratWrappers&quot;       &quot;monocle3&quot;             &quot;ROCR&quot;                
## [11] &quot;KernSmooth&quot;           &quot;fields&quot;               &quot;viridisLite&quot;          &quot;spam&quot;                 &quot;lubridate&quot;           
## [16] &quot;forcats&quot;              &quot;dplyr&quot;                &quot;purrr&quot;                &quot;readr&quot;                &quot;tidyr&quot;               
## [21] &quot;tibble&quot;               &quot;ggplot2&quot;              &quot;tidyverse&quot;            &quot;patchwork&quot;            &quot;grid&quot;                
## [26] &quot;cowplot&quot;              &quot;stringr&quot;              &quot;DoubletFinder&quot;        &quot;celda&quot;                &quot;Matrix&quot;              
## [31] &quot;BiocParallel&quot;         &quot;data.table&quot;           &quot;gridExtra&quot;            &quot;DropletUtils&quot;         &quot;SingleCellExperiment&quot;
## [36] &quot;SummarizedExperiment&quot; &quot;Biobase&quot;              &quot;MatrixGenerics&quot;       &quot;matrixStats&quot;          &quot;Seurat&quot;              
## [41] &quot;SeuratObject&quot;         &quot;sp&quot;                   &quot;rtracklayer&quot;          &quot;GenomicRanges&quot;        &quot;GenomeInfoDb&quot;        
## [46] &quot;IRanges&quot;              &quot;S4Vectors&quot;            &quot;BiocGenerics&quot;         &quot;stats4&quot;               &quot;stats&quot;               
## [51] &quot;graphics&quot;             &quot;grDevices&quot;            &quot;utils&quot;                &quot;datasets&quot;             &quot;methods&quot;             
## [56] &quot;base&quot;                
## 
## [[4]]
##  [1] &quot;EnhancedVolcano&quot;      &quot;ggrepel&quot;              &quot;HGNChelper&quot;           &quot;data.tree&quot;            &quot;igraph&quot;              
##  [6] &quot;ggraph&quot;               &quot;parallel&quot;             &quot;SeuratWrappers&quot;       &quot;monocle3&quot;             &quot;ROCR&quot;                
## [11] &quot;KernSmooth&quot;           &quot;fields&quot;               &quot;viridisLite&quot;          &quot;spam&quot;                 &quot;lubridate&quot;           
## [16] &quot;forcats&quot;              &quot;dplyr&quot;                &quot;purrr&quot;                &quot;readr&quot;                &quot;tidyr&quot;               
## [21] &quot;tibble&quot;               &quot;ggplot2&quot;              &quot;tidyverse&quot;            &quot;patchwork&quot;            &quot;grid&quot;                
## [26] &quot;cowplot&quot;              &quot;stringr&quot;              &quot;DoubletFinder&quot;        &quot;celda&quot;                &quot;Matrix&quot;              
## [31] &quot;BiocParallel&quot;         &quot;data.table&quot;           &quot;gridExtra&quot;            &quot;DropletUtils&quot;         &quot;SingleCellExperiment&quot;
## [36] &quot;SummarizedExperiment&quot; &quot;Biobase&quot;              &quot;MatrixGenerics&quot;       &quot;matrixStats&quot;          &quot;Seurat&quot;              
## [41] &quot;SeuratObject&quot;         &quot;sp&quot;                   &quot;rtracklayer&quot;          &quot;GenomicRanges&quot;        &quot;GenomeInfoDb&quot;        
## [46] &quot;IRanges&quot;              &quot;S4Vectors&quot;            &quot;BiocGenerics&quot;         &quot;stats4&quot;               &quot;stats&quot;               
## [51] &quot;graphics&quot;             &quot;grDevices&quot;            &quot;utils&quot;                &quot;datasets&quot;             &quot;methods&quot;             
## [56] &quot;base&quot;</code></pre>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">c</span>(<span class="st">&quot;dplyr&quot;</span>,<span class="st">&quot;Seurat&quot;</span>,<span class="st">&quot;HGNChelper&quot;</span>), library, <span class="at">character.only =</span> T)</span></code></pre></div>
</details>
<pre><code>## [[1]]
##  [1] &quot;EnhancedVolcano&quot;      &quot;ggrepel&quot;              &quot;HGNChelper&quot;           &quot;data.tree&quot;            &quot;igraph&quot;              
##  [6] &quot;ggraph&quot;               &quot;parallel&quot;             &quot;SeuratWrappers&quot;       &quot;monocle3&quot;             &quot;ROCR&quot;                
## [11] &quot;KernSmooth&quot;           &quot;fields&quot;               &quot;viridisLite&quot;          &quot;spam&quot;                 &quot;lubridate&quot;           
## [16] &quot;forcats&quot;              &quot;dplyr&quot;                &quot;purrr&quot;                &quot;readr&quot;                &quot;tidyr&quot;               
## [21] &quot;tibble&quot;               &quot;ggplot2&quot;              &quot;tidyverse&quot;            &quot;patchwork&quot;            &quot;grid&quot;                
## [26] &quot;cowplot&quot;              &quot;stringr&quot;              &quot;DoubletFinder&quot;        &quot;celda&quot;                &quot;Matrix&quot;              
## [31] &quot;BiocParallel&quot;         &quot;data.table&quot;           &quot;gridExtra&quot;            &quot;DropletUtils&quot;         &quot;SingleCellExperiment&quot;
## [36] &quot;SummarizedExperiment&quot; &quot;Biobase&quot;              &quot;MatrixGenerics&quot;       &quot;matrixStats&quot;          &quot;Seurat&quot;              
## [41] &quot;SeuratObject&quot;         &quot;sp&quot;                   &quot;rtracklayer&quot;          &quot;GenomicRanges&quot;        &quot;GenomeInfoDb&quot;        
## [46] &quot;IRanges&quot;              &quot;S4Vectors&quot;            &quot;BiocGenerics&quot;         &quot;stats4&quot;               &quot;stats&quot;               
## [51] &quot;graphics&quot;             &quot;grDevices&quot;            &quot;utils&quot;                &quot;datasets&quot;             &quot;methods&quot;             
## [56] &quot;base&quot;                
## 
## [[2]]
##  [1] &quot;EnhancedVolcano&quot;      &quot;ggrepel&quot;              &quot;HGNChelper&quot;           &quot;data.tree&quot;            &quot;igraph&quot;              
##  [6] &quot;ggraph&quot;               &quot;parallel&quot;             &quot;SeuratWrappers&quot;       &quot;monocle3&quot;             &quot;ROCR&quot;                
## [11] &quot;KernSmooth&quot;           &quot;fields&quot;               &quot;viridisLite&quot;          &quot;spam&quot;                 &quot;lubridate&quot;           
## [16] &quot;forcats&quot;              &quot;dplyr&quot;                &quot;purrr&quot;                &quot;readr&quot;                &quot;tidyr&quot;               
## [21] &quot;tibble&quot;               &quot;ggplot2&quot;              &quot;tidyverse&quot;            &quot;patchwork&quot;            &quot;grid&quot;                
## [26] &quot;cowplot&quot;              &quot;stringr&quot;              &quot;DoubletFinder&quot;        &quot;celda&quot;                &quot;Matrix&quot;              
## [31] &quot;BiocParallel&quot;         &quot;data.table&quot;           &quot;gridExtra&quot;            &quot;DropletUtils&quot;         &quot;SingleCellExperiment&quot;
## [36] &quot;SummarizedExperiment&quot; &quot;Biobase&quot;              &quot;MatrixGenerics&quot;       &quot;matrixStats&quot;          &quot;Seurat&quot;              
## [41] &quot;SeuratObject&quot;         &quot;sp&quot;                   &quot;rtracklayer&quot;          &quot;GenomicRanges&quot;        &quot;GenomeInfoDb&quot;        
## [46] &quot;IRanges&quot;              &quot;S4Vectors&quot;            &quot;BiocGenerics&quot;         &quot;stats4&quot;               &quot;stats&quot;               
## [51] &quot;graphics&quot;             &quot;grDevices&quot;            &quot;utils&quot;                &quot;datasets&quot;             &quot;methods&quot;             
## [56] &quot;base&quot;                
## 
## [[3]]
##  [1] &quot;EnhancedVolcano&quot;      &quot;ggrepel&quot;              &quot;HGNChelper&quot;           &quot;data.tree&quot;            &quot;igraph&quot;              
##  [6] &quot;ggraph&quot;               &quot;parallel&quot;             &quot;SeuratWrappers&quot;       &quot;monocle3&quot;             &quot;ROCR&quot;                
## [11] &quot;KernSmooth&quot;           &quot;fields&quot;               &quot;viridisLite&quot;          &quot;spam&quot;                 &quot;lubridate&quot;           
## [16] &quot;forcats&quot;              &quot;dplyr&quot;                &quot;purrr&quot;                &quot;readr&quot;                &quot;tidyr&quot;               
## [21] &quot;tibble&quot;               &quot;ggplot2&quot;              &quot;tidyverse&quot;            &quot;patchwork&quot;            &quot;grid&quot;                
## [26] &quot;cowplot&quot;              &quot;stringr&quot;              &quot;DoubletFinder&quot;        &quot;celda&quot;                &quot;Matrix&quot;              
## [31] &quot;BiocParallel&quot;         &quot;data.table&quot;           &quot;gridExtra&quot;            &quot;DropletUtils&quot;         &quot;SingleCellExperiment&quot;
## [36] &quot;SummarizedExperiment&quot; &quot;Biobase&quot;              &quot;MatrixGenerics&quot;       &quot;matrixStats&quot;          &quot;Seurat&quot;              
## [41] &quot;SeuratObject&quot;         &quot;sp&quot;                   &quot;rtracklayer&quot;          &quot;GenomicRanges&quot;        &quot;GenomeInfoDb&quot;        
## [46] &quot;IRanges&quot;              &quot;S4Vectors&quot;            &quot;BiocGenerics&quot;         &quot;stats4&quot;               &quot;stats&quot;               
## [51] &quot;graphics&quot;             &quot;grDevices&quot;            &quot;utils&quot;                &quot;datasets&quot;             &quot;methods&quot;             
## [56] &quot;base&quot;</code></pre>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load gene set preparation function</span></span>
<span id="cb98-2"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;https://raw.githubusercontent.com/IanevskiAleksandr/sc-type/master/R/gene_sets_prepare.R&quot;</span>)</span>
<span id="cb98-3"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co"># load cell type annotation function</span></span>
<span id="cb98-4"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;https://raw.githubusercontent.com/IanevskiAleksandr/sc-type/master/R/sctype_score_.R&quot;</span>)</span>
<span id="cb98-5"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="do">####</span></span>
<span id="cb98-7"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="co"># define functions</span></span>
<span id="cb98-8"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-8" aria-hidden="true" tabindex="-1"></a>perform_sctype_analysis <span class="ot">&lt;-</span> <span class="cf">function</span>(seurat_obj, db_, tissue, <span class="at">gs_removal_list =</span> <span class="fu">c</span>(), </span>
<span id="cb98-9"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">metadat_col_prefix =</span> <span class="st">&quot;db_prefix&quot;</span>, <span class="at">figure_prefix =</span><span class="st">&quot;fig_name&quot;</span> ,</span>
<span id="cb98-10"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">cluster_res =</span> <span class="st">&quot;RNA_snn_res.0.9&quot;</span>, <span class="at">output_file =</span> <span class="st">&quot;&quot;</span>) {</span>
<span id="cb98-11"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare gene sets</span></span>
<span id="cb98-12"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-12" aria-hidden="true" tabindex="-1"></a>  gs_list <span class="ot">&lt;-</span> <span class="fu">gene_sets_prepare</span>(db_, tissue)</span>
<span id="cb98-13"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-14"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove specified gene sets</span></span>
<span id="cb98-15"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (gs <span class="cf">in</span> gs_removal_list) {</span>
<span id="cb98-16"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-16" aria-hidden="true" tabindex="-1"></a>    gs_list[[<span class="st">&quot;gs_positive&quot;</span>]][[gs]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb98-17"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-18"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-19"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate sctype scores</span></span>
<span id="cb98-20"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-20" aria-hidden="true" tabindex="-1"></a>  es.max <span class="ot">&lt;-</span> <span class="fu">sctype_score</span>(<span class="at">scRNAseqData =</span> seurat_obj<span class="sc">@</span>assays<span class="sc">$</span>RNA<span class="sc">$</span>scale.data, <span class="at">scaled =</span> <span class="cn">TRUE</span>, </span>
<span id="cb98-21"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">gs =</span> gs_list<span class="sc">$</span>gs_positive, <span class="at">gs2 =</span> gs_list<span class="sc">$</span>gs_negative)</span>
<span id="cb98-22"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-23"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set identities in Seurat object</span></span>
<span id="cb98-24"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Idents</span>(seurat_obj) <span class="ot">&lt;-</span> cluster_res</span>
<span id="cb98-25"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-26"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge by cluster</span></span>
<span id="cb98-27"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-27" aria-hidden="true" tabindex="-1"></a>  cL_results <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, <span class="fu">lapply</span>(<span class="fu">unique</span>(seurat_obj<span class="sc">@</span>meta.data[[cluster_res]]), <span class="cf">function</span>(cl) {</span>
<span id="cb98-28"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-28" aria-hidden="true" tabindex="-1"></a>    es.max.cl <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">rowSums</span>(es.max[, <span class="fu">rownames</span>(seurat_obj<span class="sc">@</span>meta.data[seurat_obj<span class="sc">@</span>meta.data[[cluster_res]] <span class="sc">==</span> cl, ])]), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb98-29"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="fu">data.frame</span>(<span class="at">cluster =</span> cl, <span class="at">type =</span> <span class="fu">names</span>(es.max.cl), <span class="at">scores =</span> es.max.cl, <span class="at">ncells =</span> <span class="fu">sum</span>(seurat_obj<span class="sc">@</span>meta.data[[cluster_res]] <span class="sc">==</span> cl)), <span class="dv">10</span>)</span>
<span id="cb98-30"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-30" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb98-31"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-32"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-32" aria-hidden="true" tabindex="-1"></a>  sctype_scores <span class="ot">&lt;-</span> cL_results <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span> <span class="fu">top_n</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">wt =</span> scores)</span>
<span id="cb98-33"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-34"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set low-confident clusters to &quot;Unknown&quot;</span></span>
<span id="cb98-35"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-35" aria-hidden="true" tabindex="-1"></a>  sctype_scores<span class="sc">$</span>scores <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(sctype_scores<span class="sc">$</span>scores)</span>
<span id="cb98-36"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-36" aria-hidden="true" tabindex="-1"></a>  sctype_scores<span class="sc">$</span>type[sctype_scores<span class="sc">$</span>scores <span class="sc">&lt;</span> sctype_scores<span class="sc">$</span>ncells <span class="sc">/</span> <span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Unknown&quot;</span></span>
<span id="cb98-37"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(sctype_scores[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb98-38"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-39"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Overlay the labels</span></span>
<span id="cb98-40"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-40" aria-hidden="true" tabindex="-1"></a>  seurat_obj<span class="sc">@</span>meta.data[[metadat_col_prefix]] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb98-41"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">unique</span>(sctype_scores<span class="sc">$</span>cluster)) {</span>
<span id="cb98-42"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-42" aria-hidden="true" tabindex="-1"></a>    cl_type <span class="ot">&lt;-</span> sctype_scores[sctype_scores<span class="sc">$</span>cluster <span class="sc">==</span> j,]</span>
<span id="cb98-43"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-43" aria-hidden="true" tabindex="-1"></a>    seurat_obj<span class="sc">@</span>meta.data[[metadat_col_prefix]][seurat_obj<span class="sc">@</span>meta.data[[cluster_res]] <span class="sc">==</span> j] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(cl_type<span class="sc">$</span>type[<span class="dv">1</span>])</span>
<span id="cb98-44"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-45"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-46"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plotting</span></span>
<span id="cb98-47"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-47" aria-hidden="true" tabindex="-1"></a>  pclass <span class="ot">&lt;-</span> <span class="fu">DimPlot</span>(seurat_obj, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">repel =</span> <span class="cn">TRUE</span>, <span class="at">group.by =</span> metadat_col_prefix)</span>
<span id="cb98-48"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(pclass)</span>
<span id="cb98-49"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-50"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save the plot to a PDF</span></span>
<span id="cb98-51"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pdf</span>(<span class="at">file =</span> <span class="fu">paste0</span>(figure_prefix, <span class="st">&quot;_&quot;</span>, metadat_col_prefix, <span class="st">&quot;_sctype_genes.pdf&quot;</span>), <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">8</span>)</span>
<span id="cb98-52"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(pclass <span class="sc">+</span> <span class="fu">ggtitle</span>(figure_prefix))</span>
<span id="cb98-53"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb98-54"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-55"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save the updated Seurat object to an RDS file</span></span>
<span id="cb98-56"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (output_file <span class="sc">!=</span> <span class="st">&quot;&quot;</span>) {</span>
<span id="cb98-57"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">saveRDS</span>(seurat_obj, <span class="at">file =</span> <span class="fu">paste0</span>(output_file, <span class="st">&quot;.rds&quot;</span>))</span>
<span id="cb98-58"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-59"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-60"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the updated Seurat object</span></span>
<span id="cb98-61"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(seurat_obj)</span>
<span id="cb98-62"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb98-63"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-64"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-65"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Define variables</span></span>
<span id="cb98-66"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-66" aria-hidden="true" tabindex="-1"></a>db_ <span class="ot">=</span> <span class="st">&quot;https://raw.githubusercontent.com/IanevskiAleksandr/sc-type/master/ScTypeDB_full.xlsx&quot;</span>; <span class="co"># this is a defualt databse from sctype </span></span>
<span id="cb98-67"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-67" aria-hidden="true" tabindex="-1"></a>tissue <span class="ot">&lt;-</span> <span class="st">&quot;Brain&quot;</span></span>
<span id="cb98-68"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-68" aria-hidden="true" tabindex="-1"></a>gs_removal_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Tanycytes&quot;</span>) <span class="co"># list of cell types from the db to remove</span></span>
<span id="cb98-69"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-70"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-70" aria-hidden="true" tabindex="-1"></a>seu_obj <span class="ot">&lt;-</span> <span class="fu">perform_sctype_analysis</span>(seu_obj, db_, tissue, gs_removal_list, </span>
<span id="cb98-71"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-71" aria-hidden="true" tabindex="-1"></a>                        <span class="at">metadat_col_prefix =</span><span class="st">&quot;sctype_db&quot;</span>, <span class="at">figure_prefix =</span> <span class="st">&quot;Day_55&quot;</span>,</span>
<span id="cb98-72"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb98-72" aria-hidden="true" tabindex="-1"></a>                        <span class="at">output_file =</span> <span class="st">&quot;Day_55&quot;</span>, <span class="at">cluster_res =</span> <span class="st">&quot;RNA_snn_res.0.9&quot;</span>)</span></code></pre></div>
</details>
<pre><code>## # A tibble: 8 Ã— 3
## # Groups:   cluster [8]
##   cluster type                      scores
##   &lt;fct&gt;   &lt;chr&gt;                      &lt;dbl&gt;
## 1 2       Immature neurons           81.3 
## 2 7       Myelinating Schwann cells   7.18
## 3 0       Mature neurons            108.  
## 4 6       Mature neurons             37.4 
## 5 3       Radial glial cells         85.1 
## 6 4       GABAergic neurons          82.8 
## 7 5       Radial glial cells         92.0 
## 8 1       Radial glial cells         94.0</code></pre>
<p><img src="bookdownproj_files/figure-html/sctype-1.png" width="672" /></p>
<p>Sctype gives us some indication of which cell types we have in our data. We can use the DE genes to get some more specific info. Glutatergic Neuronal Markers â€œSLC17A7â€,â€œSLC17A6â€,â€œGRIN1â€,â€œGRIN2Bâ€ are all DE in cluster 0 - the mature neuron cluster. This suggests these cells are indeed glutamatergic neurons.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># markers for </span></span>
<span id="cb100-2"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">FeaturePlot</span>(seu_obj, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">&quot;SLC17A7&quot;</span>,<span class="st">&quot;SLC17A6&quot;</span>,<span class="st">&quot;GRIN1&quot;</span>,<span class="st">&quot;GRIN2B&quot;</span>))</span></code></pre></div>
</details>
<p><img src="bookdownproj_files/figure-html/plot%20marker%20genes-1.png" width="672" /></p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Change the names of ScType DF to Glutatertergic neurons in metadat</span></span>
<span id="cb101-2"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb101-2" aria-hidden="true" tabindex="-1"></a>seu_obj<span class="sc">@</span>meta.data<span class="sc">$</span>sctype_db <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;Mature neurons&quot;</span>, <span class="st">&quot;Glutamatergic neurons&quot;</span>, seu_obj<span class="sc">@</span>meta.data<span class="sc">$</span>sctype_db)</span></code></pre></div>
</details>
<p>We can now plot the UMAP to ensure we have update the metadata correctly</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(seu_obj, <span class="at">group.by =</span> <span class="st">&quot;sctype_db&quot;</span>) <span class="sc">|</span> <span class="fu">DimPlot</span>(seu_obj, <span class="at">reduction =</span><span class="st">&quot;umap_iso&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;sctype_db&quot;</span>)</span></code></pre></div>
</details>
<p><img src="bookdownproj_files/figure-html/plot%20marker%20genes%20iso-1.png" width="960" /></p>
<p>It is possible to explore the radial glial cells in more detail as there are likely more subtypes of radial glial cells in this data set. For the purposes of the tutorial we will leave this annoation as is. Based on this we have 5 main cell types.</p>
<ol style="list-style-type: decimal">
<li><p>Radial glial cells</p></li>
<li><p>Immature neurons</p></li>
<li><p>Glutamatergic neurons</p></li>
<li><p>GABAergic neuorns</p></li>
</ol>
</div>
<div id="de-genes-and-isofroms-based-on-annotaed-cell-types." class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> DE genes and isofroms based on annotaed cell types.<a href="finding-differentially-expressed-genes-and-isoforms.html#de-genes-and-isofroms-based-on-annotaed-cell-types." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Cell type identification is an iterative process and often one of the most challenging aspects of single-cell analysis. For this example, we will assume that our combined approach, using automated clustering and differential expression (DE) analysis based on clusters, provides a good indication of the cell types present in our data.</p>
<p>With this foundation, we can refine our DE analysis by focusing on cell types rather than clusters. This step is critical in nearly all transcriptomic analyses, offering a wide range of possibilities for downstream investigations.</p>
<p>A common downstream approach involves generating volcano plots to visualize DE genes and isoforms. performing gene set enrichment analysis, In the following sections, we will demonstrate how to perform these types of analyses and explore their potential applications.</p>
<p>The code chunk below provides an example of how to execute these analyses:</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Set identities based on cell type</span></span>
<span id="cb103-2"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Idents</span>(seu_obj) <span class="ot">&lt;-</span> <span class="st">&quot;sctype_db&quot;</span></span>
<span id="cb103-4"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-5" aria-hidden="true" tabindex="-1"></a>all_markers_gene_celltype <span class="ot">&lt;-</span> <span class="fu">FindAllMarkers</span>(</span>
<span id="cb103-6"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> seu_obj, </span>
<span id="cb103-7"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">assay =</span> <span class="st">&quot;RNA&quot;</span>, </span>
<span id="cb103-8"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">group.by =</span> <span class="st">&quot;sctype_db&quot;</span>,  <span class="co"># Replace with your metadata column name</span></span>
<span id="cb103-9"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">logfc.threshold =</span> <span class="fl">0.5</span>, </span>
<span id="cb103-10"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.pct =</span> <span class="fl">0.20</span>, </span>
<span id="cb103-11"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">only.pos =</span> <span class="cn">FALSE</span> <span class="co"># changed this to false to get negatively DE genes to</span></span>
<span id="cb103-12"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-13"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-14"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-14" aria-hidden="true" tabindex="-1"></a>all_markers_iso_celltype <span class="ot">&lt;-</span> <span class="fu">FindAllMarkers</span>(</span>
<span id="cb103-15"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> seu_obj, </span>
<span id="cb103-16"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">assay =</span> <span class="st">&quot;iso&quot;</span>, </span>
<span id="cb103-17"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">group.by =</span> <span class="st">&quot;sctype_db&quot;</span>,  <span class="co"># Replace with your metadata column name</span></span>
<span id="cb103-18"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">logfc.threshold =</span> <span class="fl">0.5</span>, </span>
<span id="cb103-19"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.pct =</span> <span class="fl">0.20</span>, </span>
<span id="cb103-20"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">only.pos =</span> <span class="cn">FALSE</span> <span class="co"># changed this to false to get negatively DE genes to</span></span>
<span id="cb103-21"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-22"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-23"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-23" aria-hidden="true" tabindex="-1"></a><span class="co">#save the list of DE genes </span></span>
<span id="cb103-24"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-24" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(all_markers_gene_celltype, <span class="st">&quot;./output_files/DE/all_markers_one_gene_celltype.csv&quot;</span>)</span>
<span id="cb103-25"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb103-25" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(all_markers_iso_celltype, <span class="st">&quot;./output_files/DE/all_markers_one_iso_celltype.csv&quot;</span>)</span></code></pre></div>
</details>
<div id="volcano-plots" class="section level3 hasAnchor" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Volcano plots<a href="finding-differentially-expressed-genes-and-isoforms.html#volcano-plots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="findallmarkers-de" class="section level4 hasAnchor" number="5.3.1.1">
<h4><span class="header-section-number">5.3.1.1</span> FIndAllMarkers DE<a href="finding-differentially-expressed-genes-and-isoforms.html#findallmarkers-de" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Fist lets generate some volcano plots. This analysis can be useful to identify genes and isoforms that are DE and also have large fold changes. Often these types of features are the interesting for further analysis. This can be done for any of the cell types defined in our object. For the sake of brevity we will look a the Glutamatergic neurons.</p>
<p>When plotting the volcano plots, we observe that many genes exhibit both statistically significant p-values (p &lt; 0.05) and log2 fold changes -2&lt; or &gt;2. To highlight key findings, we have labeled some glutamatergic marker genes, demonstrating that the genes we expect to be upregulated in this cell type are indeed showing the expected pattern. Additionally, we have labeled VIM, a marker of radial glial and projenitor cells. As anticipated, VIM expression is downregulated in these neurons, which aligns with our expectations.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EnhancedVolcano)</span>
<span id="cb104-2"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="co">#filter for the cell type of interest </span></span>
<span id="cb104-4"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb104-4" aria-hidden="true" tabindex="-1"></a>glut_DE_iso <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(all_markers_iso_celltype, cluster <span class="sc">==</span> <span class="st">&quot;Glutamatergic neurons&quot;</span>)</span>
<span id="cb104-5"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb104-5" aria-hidden="true" tabindex="-1"></a>glut_DE_gene <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(all_markers_gene_celltype, cluster <span class="sc">==</span> <span class="st">&quot;Glutamatergic neurons&quot;</span>) </span>
<span id="cb104-6"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="co">#we can plot our colcano plot </span></span>
<span id="cb104-8"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(glut_DE_gene,</span>
<span id="cb104-9"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb104-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">lab=</span>glut_DE_gene<span class="sc">$</span>gene,</span>
<span id="cb104-10"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb104-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">x=</span><span class="st">&#39;avg_log2FC&#39;</span>, <span class="at">y=</span><span class="st">&#39;p_val_adj&#39;</span>, <span class="at">pCutoff=</span><span class="fl">0.05</span>, <span class="at">FCcutoff=</span><span class="dv">2</span>,</span>
<span id="cb104-11"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb104-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">boxedLabels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb104-12"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb104-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb104-13"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb104-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">selectLab=</span> <span class="fu">c</span>(<span class="st">&quot;SLC17A7&quot;</span>,<span class="st">&quot;SLC17A6&quot;</span>,<span class="st">&#39;GRIN1&#39;</span>,<span class="st">&quot;GRIN2B&quot;</span>,<span class="st">&#39;VIM&#39;</span>),</span>
<span id="cb104-14"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb104-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">&quot;Volcano Plot of Differentially Expressed Genes </span><span class="sc">\n</span><span class="st"> in the Glutamatergic Neurons&quot;</span>)</span></code></pre></div>
</details>
<p><img src="bookdownproj_files/figure-html/valocano1-1.png" width="768" /></p>
<p>Interestingly our long read data allows us to perform the same analysis but at the isoform level. This can be hard to interpret as there are many more features to plot on the volcano plot. for the sake a clarity we have just labelled TBR1 isoforms. This code bellow will allow suers to plot all the isofroms from agiven gene on the volacon plot making interpation of the data a bit cleaner. Here just like in @ref(Add isoform counts to Seurat object) we can see two differnt isofroms of the TBR1 gene showing regulation this cell type</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb105-1" aria-hidden="true" tabindex="-1"></a>gene <span class="ot">&lt;-</span> <span class="st">&quot;TBR1&quot;</span></span>
<span id="cb105-2"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb105-2" aria-hidden="true" tabindex="-1"></a>plot_features_list <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="fu">paste0</span>(<span class="st">&quot;(^|-|</span><span class="sc">\\</span><span class="st">b)&quot;</span>, gene, <span class="st">&quot;($|</span><span class="sc">\\</span><span class="st">b)&quot;</span>), features, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb105-3"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(glut_DE_iso,</span>
<span id="cb105-5"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb105-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">lab=</span>glut_DE_iso<span class="sc">$</span>gene,</span>
<span id="cb105-6"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb105-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">x=</span><span class="st">&#39;avg_log2FC&#39;</span>, <span class="at">y=</span><span class="st">&#39;p_val_adj&#39;</span>, <span class="at">pCutoff=</span><span class="fl">0.05</span>, <span class="at">FCcutoff=</span><span class="dv">2</span>,</span>
<span id="cb105-7"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb105-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">boxedLabels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb105-8"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb105-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">drawConnectors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb105-9"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb105-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">selectLab=</span> plot_features_list,</span>
<span id="cb105-10"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb105-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">&quot;Volcano Plot of Differentially Expressed Isoforms </span><span class="sc">\n</span><span class="st"> in the Glutamatergic Neurons&quot;</span>)</span></code></pre></div>
</details>
<p><img src="bookdownproj_files/figure-html/valocano2-1.png" width="768" /></p>
</div>
<div id="findmarkers-de" class="section level4 hasAnchor" number="5.3.1.2">
<h4><span class="header-section-number">5.3.1.2</span> FIndMarkers DE<a href="finding-differentially-expressed-genes-and-isoforms.html#findmarkers-de" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Finding All Markers is just one type of differential expression (DE) analysis that can be performed. Seurat offers the <code>FindAllMarkers</code> function, which tests the cell type of interest against all other cell types. While this approach is often sufficient for identifying marker genes, users may also want to test differences between two specific cell types. For instance, you might want to identify DE genes when comparing glutamatergic neurons to radial glial cells. Below, we demonstrate how to perform this type of analysis with the <code>FindMarkers</code> function.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DefaultAssay</span>(seu_obj) <span class="ot">&lt;-</span> <span class="st">&#39;RNA&#39;</span> <span class="co"># difeine the gne assay as default</span></span>
<span id="cb106-2"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-2" aria-hidden="true" tabindex="-1"></a>glu_RG_gene <span class="ot">&lt;-</span> <span class="fu">FindMarkers</span>(seu_obj,</span>
<span id="cb106-3"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ident.1 =</span> <span class="st">&quot;Glutamatergic neurons&quot;</span>,</span>
<span id="cb106-4"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ident.2 =</span> <span class="st">&quot;Radial glial cells&quot;</span>,</span>
<span id="cb106-5"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">logfc.threshold =</span> <span class="fl">0.5</span>, <span class="at">min.pct =</span> <span class="fl">0.02</span>)</span>
<span id="cb106-6"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="fu">DefaultAssay</span>(seu_obj) <span class="ot">&lt;-</span> <span class="st">&#39;iso&#39;</span> <span class="co"># difeine the gne assay as default</span></span>
<span id="cb106-8"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-8" aria-hidden="true" tabindex="-1"></a>glu_RG_iso <span class="ot">&lt;-</span> <span class="fu">FindMarkers</span>(seu_obj, <span class="at">ident.1 =</span> <span class="st">&quot;Glutamatergic neurons&quot;</span>,</span>
<span id="cb106-9"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ident.2 =</span> <span class="st">&quot;Radial glial cells&quot;</span>,</span>
<span id="cb106-10"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">logfc.threshold =</span> <span class="fl">0.5</span>, <span class="at">min.pct =</span> <span class="fl">0.02</span>)</span>
<span id="cb106-11"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-12"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-13"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Volcano plots</span></span>
<span id="cb106-14"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-14" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(glu_RG_gene, <span class="at">lab=</span><span class="fu">rownames</span>(glu_RG_gene),</span>
<span id="cb106-15"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">x=</span><span class="st">&#39;avg_log2FC&#39;</span>, <span class="at">y=</span><span class="st">&#39;p_val_adj&#39;</span>,</span>
<span id="cb106-16"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-16" aria-hidden="true" tabindex="-1"></a>                <span class="co">#selectLab= &quot;VIM&quot;,</span></span>
<span id="cb106-17"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">pCutoff=</span><span class="fl">0.05</span>, <span class="at">FCcutoff=</span><span class="dv">2</span>,</span>
<span id="cb106-18"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb106-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">&quot;Volcano Plot of Differentially Expressed Gene </span><span class="sc">\n</span><span class="st"> Glutamatergic Neurons vs Radial glial Cells&quot;</span>)</span></code></pre></div>
</details>
<p><img src="bookdownproj_files/figure-html/valocano3-1.png" width="768" /></p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Volcano plots</span></span>
<span id="cb107-2"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(glu_RG_iso, <span class="at">lab=</span><span class="fu">rownames</span>(glu_RG_iso),</span>
<span id="cb107-3"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb107-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">x=</span><span class="st">&#39;avg_log2FC&#39;</span>, <span class="at">y=</span><span class="st">&#39;p_val_adj&#39;</span>,</span>
<span id="cb107-4"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb107-4" aria-hidden="true" tabindex="-1"></a>                <span class="co">#selectLab= &quot;VIM&quot;,</span></span>
<span id="cb107-5"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb107-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">pCutoff=</span><span class="fl">0.05</span>, <span class="at">FCcutoff=</span><span class="dv">2</span>,</span>
<span id="cb107-6"><a href="finding-differentially-expressed-genes-and-isoforms.html#cb107-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">&quot;Volcano Plot of Differentially Expressed Isoforms </span><span class="sc">\n</span><span class="st"> Glutamatergic Neurons vs Radial glial Cells&quot;</span>)</span></code></pre></div>
</details>
<p><img src="bookdownproj_files/figure-html/valocano3-2.png" width="768" /></p>
</div>
</div>
<div id="gene-set-enrichemt" class="section level3 hasAnchor" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Gene Set enrichemt<a href="finding-differentially-expressed-genes-and-isoforms.html#gene-set-enrichemt" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TBD - Manveer to complete.</p>
<p>From this work we can see â€¦ ## plotting trajectories</p>
</div>
</div>
<div id="finding-isofrms-of-interest" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Finding isofrms of interest<a href="finding-differentially-expressed-genes-and-isoforms.html#finding-isofrms-of-interest" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="section" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> </h2>
</div>
<div id="plotting-with-ditoplot" class="section level2 hasAnchor" number="5.6">
<h2><span class="header-section-number">5.6</span> plotting with ditoplot<a href="finding-differentially-expressed-genes-and-isoforms.html#plotting-with-ditoplot" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="add-isoform-counts-to-seurat-object.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="citations-and-session-info.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/sefi196/FLAMESv2_LR_sc_tutorial/edit/main/05_Finding_differentially_expressed_genes_and_isoforms.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/sefi196/FLAMESv2_LR_sc_tutorial/blob/main/05_Finding_differentially_expressed_genes_and_isoforms.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
